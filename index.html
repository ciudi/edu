<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Test Matematică</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 980px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }
  </style>
</head>
<body>

<h1>Test Matematică</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">02:00</span></div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === Întrebări (JSON-ul tău) ===
  const questions = [
    { "question": "Rezultatul calculului 4 + 12 : 2 este egal cu:", "choices": ["6","8","10","12"], "answerIndex": 2, "explanation": "Respectând ordinea efectuării operațiilor, calculăm mai întâi împărțirea: 12 : 2 = 6, apoi adunarea: 4 + 6 = 10." },
    { "question": "Dacă a / 2 = 3 / 2, atunci valoarea fracției 4 / a este egală cu:", "choices": ["1/3","4/3","2","3"], "answerIndex": 1, "explanation": "Din egalitatea a / 2 = 3 / 2 deducem direct că a = 3. Înlocuind în expresie, rezultă 4 / 3." },
    { "question": "Rezultatul calculului 2026 - 12 : 12 este:", "choices": ["-1","0","2025","2026"], "answerIndex": 2, "explanation": "Împărțirea se efectuează prima: 12 : 12 = 1. Apoi scăderea dă 2026 - 1 = 2025." },
    { "question": "Dacă 25% dintr-un număr a este 30, atunci 30% din același număr a este:", "choices": ["25","40","24","36"], "answerIndex": 3, "explanation": "Dacă 25% din a este 30, numărul a este 30 * 4 = 120. Calculând 30% din 120, obținem (30/100) * 120 = 36." },
    { "question": "Media aritmetică a numerelor a = √12 și b = 4 - 2√3 este:", "choices": ["4√3","2","4","4 + 4√3"], "answerIndex": 1, "explanation": "Deoarece √12 = 2√3, media aritmetică este (2√3 + 4 - 2√3) / 2 = 4 / 2 = 2." },
    { "question": "Rezultatul calculului (30 + 4 * 5) : 10 este egal cu:", "choices": ["17","5","23","32"], "answerIndex": 1, "explanation": "Calculăm mai întâi înmulțirea din paranteză (4 * 5 = 20), obținem 30 + 20 = 50. Apoi 50 : 10 = 5." },
    { "question": "Triplul numărului 5/7 este egal cu:", "choices": ["15/21","5/21","15/7","8/7"], "answerIndex": 2, "explanation": "Triplul înseamnă înmulțirea cu 3: 3 * (5/7) = 15/7." },
    { "question": "Două treimi din numărul a este egal cu 24. Numărul a este egal cu:", "choices": ["16","8","12","36"], "answerIndex": 3, "explanation": "Ecuația este (2/3) * a = 24. Înmulțind cu 3 și împărțind la 2, obținem a = (24 * 3) / 2 = 36." },
    { "question": "Dintre numerele 5/13, 5/23, 5/33 și 5/43, cel mai mare este:", "choices": ["5/13","5/23","5/33","5/43"], "answerIndex": 0, "explanation": "Toate fracțiile au același numărător. Fracția cea mai mare este cea cu numitorul cel mai mic, adică 5/13." },
    { "question": "Numărul care reprezintă 30% din 300 este egal cu:", "choices": ["3","30","90","900"], "answerIndex": 2, "explanation": "Calculul este (30/100) * 300 = 30 * 3 = 90." },
    { "question": "Dintre numerele √26, 3√3, 5 și 2√6, cel mai mare este numărul:", "choices": ["√26","3√3","5","2√6"], "answerIndex": 1, "explanation": "Introducem factorii sub radical: √26, 3√3 = √27, 5 = √25, 2√6 = √24. Cel mai mare este √27, adică 3√3." },
    { "question": "Dacă a/3 = 13/2, atunci valoarea raportului (a-3)/3 este:", "choices": ["4,(6)","5","5,5","6,5"], "answerIndex": 2, "explanation": "Raportul (a-3)/3 poate fi despărțit în a/3 - 3/3 = a/3 - 1. Înlocuind a/3 obținem 13/2 - 1 = 6,5 - 1 = 5,5." },
    { "question": "Fie numerele reale a = 6 - √11 și b = 6 + √11. Diferența dintre media aritmetică și media geometrică a numerelor a și b este:", "choices": ["1","3","5","7"], "answerIndex": 0, "explanation": "Media aritmetică este (6-√11 + 6+√11)/2 = 6. Media geometrică este √((6-√11)(6+√11)) = √(36-11) = √25 = 5. Diferența este 6 - 5 = 1." },
    { "question": "Știind că x + 3y = 5, unde x și y sunt numere reale, valoarea expresiei 3x + 9y + 12 este:", "choices": ["15","17","24","27"], "answerIndex": 3, "explanation": "Scoatem factor comun 3 din primii doi termeni: 3(x + 3y) + 12. Înlocuind, obținem 3 * 5 + 12 = 15 + 12 = 27." },
    { "question": "Rezultatul calculului 12 - 2 * 7 este egal cu:", "choices": ["2","-2","0","70"], "answerIndex": 1, "explanation": "Operația de înmulțire este prioritară: 12 - 14 = -2." },
    { "question": "Media aritmetică a numerelor 10, 20, 30 și 40 este egală cu:", "choices": ["30","25","40","15"], "answerIndex": 1, "explanation": "Suma lor este 100, iar fiind patru numere, le împărțim la 4: 100 / 4 = 25." },
    { "question": "Cel mai mic număr întreg mai mare decât -3√5 este:", "choices": ["-8","-5","-6","-7"], "answerIndex": 2, "explanation": "-3√5 = -√45. Deoarece √36 < √45 < √49, adică -7 < -√45 < -6, cel mai mic număr întreg mai mare decât -√45 este -6." },
    { "question": "Dintre fracțiile zecimale 0,126 ; 0,12(6) ; 0,(126) și 0,1(26) cea mai mică este:", "choices": ["0,126","0,12(6)","0,(126)","0,1(26)"], "answerIndex": 0, "explanation": "Analizând zecimalele, avem 0,1260...; 0,1266...; 0,126126...; 0,12626... Cel mai mic număr este cel cu prima cifră a miimilor 0, adică 0,126." },
    { "question": "Diferența dintre media aritmetică și cea geometrică a numerelor 2+√3 și 2-√3 este egală cu:", "choices": ["1","2","3","4"], "answerIndex": 0, "explanation": "Media aritmetică = (2+√3 + 2-√3)/2 = 2. Media geometrică = √((2+√3)(2-√3)) = √(4-3) = 1. Diferența: 2 - 1 = 1." },
    { "question": "Dacă a = 3 + √5 și b = 3 - √5, atunci media geometrică a numerelor a și b este egală cu:", "choices": ["3","2","√5","4"], "answerIndex": 1, "explanation": "Media geometrică este √(ab) = √((3+√5)(3-√5)) = √(9-5) = √4 = 2." },
    {"question": "Fie numerele a = -2,3 și b = 4,13. Dintre numerele a, b, -a și -b, cel mai mic este numărul:","choices": ["a","b","-a","-b"],"answerIndex": 3,"explanation": "Valorile sunt a = -2,3; b = 4,13; -a = 2,3; -b = -4,13. Cel mai mic dintre acestea este -4,13, adică -b."},
    {"question": "Dacă 30% din numărul a reprezintă 45% din b, atunci valoarea raportului b/a este:","choices": ["0,(6)","0,5","1,2","1,5"],"answerIndex": 0,"explanation": "Avem ecuația 30a = 45*b. Împărțind pentru a obține b/a rezultă 30/45, care simplificat dă 2/3. Transformând în fracție zecimală este 0,(6)."},
    { "question": "Rezultatul calculului 2025^0 + 2025 : 2025 - 1^2025 + 0^2025 este egal cu:", "choices": ["2025","0","2024","1"], "answerIndex": 3, "explanation": "Avem: 2025^0 = 1; 2025 : 2025 = 1; 1^2025 = 1; 0^2025 = 0. Calculul final devine: 1 + 1 - 1 + 0 = 1." },
    { "question": "Fie proporția x/y = 5/7. Valoarea expresiei 49x - 35y este egală cu:", "choices": ["0","5/7","7/5","35"], "answerIndex": 0, "explanation": "Din proporție rezultă 7x = 5y, echivalent cu 7x - 5y = 0. Înmulțind totul cu 7, obținem 49x - 35y = 0." },
    { "question": "Într-o clasă sunt 25 de elevi. 15 elevi joacă handbal, 11 elevi joacă fotbal și 5 elevi nu practică niciun sport. Câți elevi joacă și handbal și fotbal?", "choices": ["6","5","1","8"], "answerIndex": 0, "explanation": "Numărul elevilor care practică măcar un sport este 25 - 5 = 20. Adunând 15 + 11 = 26. Intersecția este 26 - 20 = 6." }
  ];

  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  // === CERINȚĂ TEST MATEMATICĂ: 2 minute / întrebare,
  // dar 7 minute pentru întrebări cu figuri geometrice / puncte coliniare / figură alăturată ===
  const DEFAULT_TIME = 2 * 60;  // 2 min
  const GEOM_TIME = 7 * 60;     // 7 min

  function isGeometryQuestion(text) {
    const t = (text || "").toLowerCase();
    const keywords = [
      "figur", "figura", "alătur", "alatur",
      "coliniar", "puncte", "segment", "triunghi",
      "cerc", "romb", "pătrat", "patrat", "paralelogram",
      "trapez", "cub", "piramid", "diagonal", "unghi", "aria", "perimetr"
    ];
    return keywords.some(k => t.includes(k));
  }

  function timeForQuestion(q) {
    // dacă se detectează context geometric / figură -> 7 minute, altfel 2 minute
    return isGeometryQuestion(q.question) ? GEOM_TIME : DEFAULT_TIME;
  }

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME;
  let currentLimit = DEFAULT_TIME;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  function escapeHtml(s){
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function formatText(raw) {
    // păstrăm simplu; dacă vrei MathJax ulterior, îl putem integra.
    return escapeHtml(raw);
  }

  function fmtTime(seconds){
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
  }

  function startTimer(){
    stopTimer();
    const q = questions[idx];
    currentLimit = timeForQuestion(q);
    remaining = currentLimit;

    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${fmtTime(remaining)}</span>`;
    timeBar.style.width = "100%";

    timer = setInterval(() => {
      remaining -= 1;
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = fmtTime(Math.max(remaining, 0));

      const pct = (remaining / currentLimit) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const perQ = timeForQuestion(q);

    app.innerHTML = `
      <h2>${formatText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${formatText(c)}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>Timp / întrebare: <code>${fmtTime(perQ)}</code></div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        document.getElementById("feedback").innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    startTimer();
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${formatText(q.choices[selectedIndex])}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    document.getElementById("feedback").innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${formatText(q.choices[correct])}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${formatText(q.explanation || "(fără explicație)")}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    const scoreNow = document.getElementById("scoreNow");
    if (scoreNow) scoreNow.textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe testul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
