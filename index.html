<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }
    a { color: inherit; text-decoration: underline; }
    .emph { font-weight: 700; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Quiz</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">30</span>s</div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === JSON nou ===
  const questions = [
    {
      "question": "În poezia „O, rămâi...” de Mihai Eminescu (Link text: https://ro.wikisource.org/wiki/O,_r%C4%83m%C3%A2i), versurile „Anii tăi se par **ca clipe** / Clipe dulci se par ca veacuri” conțin:",
      "choices": ["O metaforă", "O comparație", "O personificare", "Un epitet cromatic"],
      "answerIndex": 1,
      "explanation": "Prezența termenului de legătură „ca” indică o comparație explicită între scurgerea timpului (anii) și percepția subiectivă (clipe/veacuri)."
    },
    {
      "question": "Conform regulilor de ortografie din surse, forma corectă a numeralului ordinal feminin este:",
      "choices": ["A doisprezecea", "A douăsprezecea", "A doișpea", "A douășpea"],
      "answerIndex": 1,
      "explanation": "Numeralul 12 feminin se formează de la „două” + „spre” + „zece” + articolul „a”. Forma corectă este „a douăsprezecea”."
    },
    {
      "question": "În enunțul „El **mă** apără de pericole”, pronumele evidențiat este:",
      "choices": ["Reflexiv", "Personal", "Posesiv", "Demonstrativ"],
      "answerIndex": 1,
      "explanation": "Deoarece acțiunea este făcută de „El” (subiectul), dar se răsfrânge asupra „mea” (persoane diferite), pronumele „mă” este personal, nu reflexiv."
    },
    {
      "question": "În nuvela „Popa Tanda” de Ioan Slavici (Link text: https://ro.wikisource.org/wiki/Popa_Tanda), valoarea morală centrală identificată în tabelul de valori este:",
      "choices": ["Responsabilitatea față de ceilalți", "Vicleșugul", "Răzbunarea", "Singurătatea"],
      "answerIndex": 0,
      "explanation": "Tabelul de valori asociază opera „Popa Tanda” cu responsabilitatea față de ceilalți și spiritul comunitar."
    },
    {
      "question": "În fraza „Îl voi întreba **dacă vii și tu la spectacol**”, propoziția subordonată este:",
      "choices": ["Circumstanțială de timp", "Completivă Directă", "Atributivă", "Subiectivă"],
      "answerIndex": 1,
      "explanation": "Întrebarea se pune verbului „voi întreba”: Ce voi întreba? -> „dacă vii și tu”. Răspunsul indică o completivă directă."
    },
    {
      "question": "În versurile „Și vorba-i **tunet**, răsufletul ger, / Iar barda din stânga-i ajunge la cer” din „Pașa Hassan” (Link text: https://ro.wikisource.org/wiki/Pa%C8%99a_Hassan), figura de stil este:",
      "choices": ["Hiperbola", "Aliterația", "Oximoronul", "Litota"],
      "answerIndex": 0,
      "explanation": "Poetul exagerează intenționat trăsăturile personajului (Mihai Viteazul) pentru a impresiona, procedeu specific hiperbolei."
    },
    {
      "question": "Identifică valoarea morfologică a verbului „a fi” în enunțul: „Telefonul **este** pe birou.”",
      "choices": ["Verb copulativ", "Verb predicativ", "Verb auxiliar", "Verb impersonal"],
      "answerIndex": 1,
      "explanation": "Aici, „este” are sensul de „se află” sau „există”, având funcția de predicat verbal (este verb predicativ)."
    },
    {
      "question": "Termenul „design” este un neologism împrumutat din limba:",
      "choices": ["Franceză", "Engleză", "Germană", "Italiană"],
      "answerIndex": 1,
      "explanation": "Conform listei de împrumuturi recente, „design”, „weekend” și „volei” provin din engleză."
    },
    {
      "question": "În enunțul „A luptat **contra** inamicilor”, substantivul „inamicilor” este în cazul:",
      "choices": ["Dativ", "Genitiv", "Acuzativ", "Nominativ"],
      "answerIndex": 1,
      "explanation": "Prepozițiile „contra”, „împotriva”, „asupra” cer obligatoriu cazul Genitiv."
    },
    {
      "question": "Alege varianta corectă a articolului genitival: „Cărțile de joc **ale** / **a** Mariei sunt pe masă.”",
      "choices": ["a", "ale"],
      "answerIndex": 1,
      "explanation": "Articolul genitival se acordă cu obiectul posedat (cărțile - feminin, plural), deci forma corectă este „ale”."
    },
    {
      "question": "În textul dramatic, notațiile autorului scrise între paranteze (referitoare la decor, gesturi, mimică) se numesc:",
      "choices": ["Replici", "Didascalii (indicații scenice)", "Monologuri", "Acte"],
      "answerIndex": 1,
      "explanation": "Didascaliile sunt singura intervenție directă a autorului în textul dramatic, oferind instrucțiuni pentru reprezentarea scenică."
    },
    {
      "question": "Care este raportul de coordonare în fraza: „Am învățat, **dar** n-am știut răspunsul.”?",
      "choices": ["Copulativ", "Disjunctiv", "Adversativ", "Concluziv"],
      "answerIndex": 2,
      "explanation": "Conjuncția „dar” (ca și „iar”, „însă”, „ci”) exprimă o opoziție între două propoziții, stabilind un raport adversativ."
    },
    {
      "question": "Cuvântul „**frățește**” este un adverb format prin:",
      "choices": ["Compunere", "Conversiune", "Derivare", "Împrumut"],
      "answerIndex": 2,
      "explanation": "Este format de la rădăcina „frate” + sufixul „-ește”, specific adverbelor de mod derivate."
    },
    {
      "question": "În versul „**V**âjâind ca **v**ijelia și ca plesnetul de ploaie” (Mihai Eminescu), repetarea consoanei „v” creează o:",
      "choices": ["Metaforă", "Aliterație", "Personificare", "Antiteză"],
      "answerIndex": 1,
      "explanation": "Aliterația constă în repetarea unor consoane pentru a obține un efect sonor imitativ (aici, sunetul vântului)."
    },
    {
      "question": "În sintagma „Cartea **citită** mi-a plăcut”, cuvântul evidențiat este:",
      "choices": ["Verb la gerunziu", "Adjectiv provenit din participiu", "Adverb de mod", "Substantiv"],
      "answerIndex": 1,
      "explanation": "Verbul la participiu („citit”) se acordă cu substantivul „cartea” (feminin, singular), devenind adjectiv prin conversiune."
    },
    {
      "question": "Selectează forma corectă a verbului „a așeza” la indicativ prezent, persoana a III-a singular:",
      "choices": ["El așează", "El așază"],
      "answerIndex": 1,
      "explanation": "Conform DOOM și regulilor fonetice actuale, forma corectă este „așază” (nu „așează”), păstrând rădăcina nealterată după ș/j."
    },
    {
      "question": "În enunțul „Domnule academician, vă rog să interveniți”, limbajul folosit aparține registrului:",
      "choices": ["Familiar", "Solemn (oficial)", "Standard", "Regional"],
      "answerIndex": 1,
      "explanation": "Adresarea protocolară și termenii de politețe maximă indică registrul solemn/oficial."
    },
    {
      "question": "În propoziția „**Ana și Ioana** merg la școală”, subiectul este:",
      "choices": ["Simplu", "Multiplu", "Inclus", "Subînțeles"],
      "answerIndex": 1,
      "explanation": "Există doi termeni coordonați („Ana și Ioana”) care realizează acțiunea, formând un subiect multiplu."
    },
    {
      "question": "În enunțul „Afară **se înserează**”, verbul este:",
      "choices": ["Predicativ personal", "Impersonal", "Copulativ", "Auxiliar"],
      "answerIndex": 1,
      "explanation": "Verbele care exprimă fenomene atmosferice (a ploua, a ninge, a se însera) nu au subiect (sunt unipersonale/impersonale)."
    },
    {
      "question": "Sinonimul neologic pentru cuvântul „molimă”, conform surselor despre împrumuturi, este:",
      "choices": ["Boală", "Epidemie", "Tristețe", "Sărăcie"],
      "answerIndex": 1,
      "explanation": "Textul despre împrumuturi menționează că termenul grecesc „molimă” a fost înlocuit de neologismul „epidemie”."
    },
    {
      "question": "Care este sensul expresiei argotice „a face blat” în context școlar?",
      "choices": ["A găti o prăjitură", "A aranja ceva în secret / a copia", "A lipsi de la școală", "A învăța foarte bine"],
      "answerIndex": 1,
      "explanation": "Argoul școlar folosește termeni codificați; „blat” se referă la o înțelegere secretă sau o acțiune ilicită (copiat)."
    },
    {
      "question": "Propoziția „Locul **unde am copilărit** nu va fi uitat” conține o subordonată:",
      "choices": ["Completivă directă", "Atributivă", "Circumstanțială de loc", "Subiectivă"],
      "answerIndex": 1,
      "explanation": "Chiar dacă este introdusă prin „unde”, ea determină substantivul „locul” (care loc?), deci este o Atributivă."
    },
    {
      "question": "În cuvântul „t**oa**mna”, grupul de sunete evidențiat este un:",
      "choices": ["Hiat", "Diftong", "Triftong", "Nu formează un grup vocalic"],
      "answerIndex": 1,
      "explanation": "Sunetele 'o' și 'a' sunt pronunțate în aceeași silabă (toam-na), 'o' fiind semivocală și 'a' vocală, formând un diftong."
    },
    {
      "question": "Alege varianta scrisă corect cu cratimă:",
      "choices": ["Nu mii frică", "Nu mi-i frică", "Nu m-ii frică", "Nu mi-ii frică"],
      "answerIndex": 1,
      "explanation": "Structura este formată din pronumele „mi” (mie) + verbul „i” (este scurtat): „Nu mi-i frică” (Nu îmi este frică)."
    },
    {
      "question": "În fraza „Sau înveți, **sau** mergi la plimbare”, virgula este folosită deoarece:",
      "choices": ["Conjuncțiile disjunctive sunt pereche", "Este o greșeală de punctuație", "Este o propoziție incidentă", "Conjuncția este copulativă"],
      "answerIndex": 0,
      "explanation": "Când conjuncțiile disjunctive (sau... sau, ori... ori) sunt folosite în pereche, virgula este obligatorie înainte de al doilea termen."
    }
  ];

  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  const DEFAULT_TIME_PER_Q = 30;

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME_PER_Q;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  // întrebările cu "Link text:" -> timp infinit
  function questionHasLinkText(q) {
    return /Link text:\s*https?:\/\/[^\s)]+/.test(q);
  }

  function setInfiniteTimerUI(){
    stopTimer();
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">∞</span>`;
    progressWrap.style.display = "none";
  }

  function startTimer(seconds){
    stopTimer();
    remaining = seconds;
    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${remaining}</span>s`;
    timeBar.style.width = "100%";

    timer = setInterval(() => {
      remaining -= 1;
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = remaining;

      const pct = (remaining / seconds) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function formatQuestionText(raw) {
    let text = raw;

    // **...** -> bold + underline
    text = text.replace(/\*\*(.+?)\*\*/g, '<span class="emph">$1</span>');

    // (Link text: URL) -> link + spațiu înainte de ")"
    text = text.replace(
      /\(Link text:\s*(https?:\/\/[^\s)]+)\)/g,
      (m, url) => `(Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a> )`
    );

    // Link text: URL (cu punctuație după) -> link
    text = text.replace(
      /Link text:\s*(https?:\/\/[^\s),.]+)([),.]?)/g,
      (m, url, punct) => `Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>${punct || ""}`
    );

    return text;
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const hasLink = questionHasLinkText(q.question);

    app.innerHTML = `
      <h2>${formatQuestionText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${c}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>${hasLink ? `Timp / întrebare: <code>∞</code>` : `Timp / întrebare: <code>${DEFAULT_TIME_PER_Q}s</code>`}</div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        document.getElementById("feedback").innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    if (hasLink) setInfiniteTimerUI();
    else startTimer(DEFAULT_TIME_PER_Q);
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${q.choices[selectedIndex]}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    document.getElementById("feedback").innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${q.choices[correct]}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${q.explanation ?? "(fără explicație)"}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    document.getElementById("scoreNow").textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe quiz-ul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
