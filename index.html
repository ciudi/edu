<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }
    a { color: inherit; }
  </style>
</head>
<body>

<h1>Quiz</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">30</span>s</div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === JSON-ul tău ===
  const questions = [
    {
      "question": "În basmul cult „Povestea lui Harap-Alb” (Link text: https://ro.wikisource.org/wiki/Povestea_lui_Harap-Alb ), valoarea morală principală pe care o dobândește protagonistul este:",
      "choices": ["Vicleșugul", "Curajul și asumarea responsabilității", "Lăcomia", "Indiferența"],
      "answerIndex": 1,
      "explanation": "Călătoria lui Harap-Alb este un drum de inițiere în care acesta învață să își asume responsabilități și să dea dovadă de curaj și onestitate."
    },
    {
      "question": "Identifică funcția sintactică a cuvântului evidențiat: „Eforturile lor erau **crescânde**.”",
      "choices": ["Verb la gerunziu", "Adjectiv provenit din gerunziu", "Adverb de mod", "Substantiv"],
      "answerIndex": 1,
      "explanation": "Deși are formă de gerunziu, cuvântul se acordă cu substantivul „eforturile”, devenind adjectiv."
    },
    {
      "question": "Alege forma corectă a verbului **a crea** pentru persoana I, plural, indicativ prezent: „Noi ... un site nou.”",
      "choices": ["creem", "creăm", "crim", "creiem"],
      "answerIndex": 1,
      "explanation": "Verbul „a crea” se conjugă după modelul „a lucra” (lucrăm -> creăm)."
    },
    {
      "question": "În poezia „Fiind băiet păduri cutreieram” (Link text: https://ro.wikisource.org/wiki/Fiind_b%C4%83iet_p%C4%83duri_cutreieram ), versul „Un **freamăt** lin trecea din ram în ram” conține o imagine:",
      "choices": ["Vizuală", "Auditivă", "Olfactivă", "Gustativă"],
      "answerIndex": 1,
      "explanation": "Cuvântul „freamăt” sugerează sunetul produs de vânt sau de frunze, fiind o imagine auditivă."
    },
    {
      "question": "În propoziția „Timpul este focul **în care ne ardem existența**”, secvența evidențiată este o propoziție subordonată:",
      "choices": ["Completivă directă", "Atributivă", "Predicativă", "Circumstanțială de timp"],
      "answerIndex": 1,
      "explanation": "Propoziția determină substantivul „focul” (care foc?), îndeplinind funcția de atribut."
    },
    {
      "question": "În fabula „Vulpea în livadă” (Link text: https://ro.wikisource.org/wiki/Vulpea_%C3%AEn_livad%C4%83 ), figura de stil prin care sunt atribuite vulpii trăsături umane (ipocrizia) este:",
      "choices": ["Metafora", "Personificarea", "Epitetul", "Hiperbola"],
      "answerIndex": 1,
      "explanation": "Personificarea este procedeul prin care animalele primesc însușiri umane, specific fabulei."
    },
    {
      "question": "Alege varianta corectă: „**Fii** / **Fi** mai atent la ore!”",
      "choices": ["Fi", "Fii"],
      "answerIndex": 1,
      "explanation": "Imperativul afirmativ al verbului „a fi” se scrie obligatoriu cu doi 'i'."
    },
    {
      "question": "În versurile din „Dimineața” de Vasile Alecsandri (Link text: https://ro.wikisource.org/wiki/Diminea%C8%9Ba_(Alecsandri)): „Raze vii sărută june flori de primăvară”, verbul **sărută** construiește o:",
      "choices": ["Comparație", "Personificare", "Enumerație", "Repetiție"],
      "answerIndex": 1,
      "explanation": "Razele soarelui primesc o însușire umană (acțiunea de a săruta), realizând o personificare."
    },
    {
      "question": "În enunțul „Eu **mă** apăr.”, pronumele evidențiat este:",
      "choices": ["Personal", "Reflexiv", "Posesiv", "Demonstrativ"],
      "answerIndex": 1,
      "explanation": "Subiectul (Eu) face acțiunea care se răsfrânge asupra sa; persoana pronumelui coincide cu a verbului."
    },
    {
      "question": "Precizează cazul cuvântului evidențiat: „I-am mulțumit **colegului** pentru ajutor.”",
      "choices": ["Genitiv", "Dativ", "Acuzativ", "Nominativ"],
      "answerIndex": 1,
      "explanation": "Cuvântul răspunde la întrebarea „cui (i-am mulțumit)?”, specifică Dativului."
    },
    {
      "question": "În textul „România Pitorească” (Link text: https://ro.wikisource.org/wiki/Rom%C3%A2nia_Pitoreasc%C4%83), Vlahuță descrie Dunărea folosind sintagma „**clocot** de valuri”, care sugerează:",
      "choices": ["Liniștea apei", "Dinamismul și forța apei", "Culoarea apei", "Adâncimea apei"],
      "answerIndex": 1,
      "explanation": "Termenul „clocot” este o metaforă care sugerează mișcarea violentă, agitată și zgomotoasă a apei."
    },
    {
      "question": "Alege varianta corectă la forma negativă: „Nu **fi** / **fii** trist!”",
      "choices": ["fii", "fi"],
      "answerIndex": 1,
      "explanation": "Imperativul negativ al verbului „a fi” se scrie cu un singur 'i'."
    },
    {
      "question": "În propoziția „Am observat **că ai întârziat**”, propoziția subordonată este:",
      "choices": ["Subiectivă", "Completivă Directă", "Atributivă", "Circumstanțială de cauză"],
      "answerIndex": 1,
      "explanation": "Întrebarea se pune verbului regent: „Ce am observat?” -> „că ai întârziat” (Completivă Directă)."
    },
    {
      "question": "Identifică sinonimul potrivit pentru cuvântul **distinsă** în contextul: „O prezență distinsă.”",
      "choices": ["Obișnuită", "Remarcabilă", "Ștearsă", "Veselă"],
      "answerIndex": 1,
      "explanation": "„Distinsă” înseamnă nobilă, deosebită, care iese în evidență (remarcabilă)."
    },
    {
      "question": "Valoarea morfologică a cuvântului **a munci** din enunțul „A munci este onorabil” este:",
      "choices": ["Verb la indicativ", "Substantiv", "Verb la infinitiv", "Adjectiv"],
      "answerIndex": 2,
      "explanation": "Este forma de dicționar a verbului, precedată de „a”, specifică modului infinitiv."
    },
    {
      "question": "În enunțul „Mașina **vecinului** este roșie”, substantivul evidențiat este în cazul:",
      "choices": ["Nominativ", "Acuzativ", "Genitiv", "Dativ"],
      "answerIndex": 2,
      "explanation": "Indică posesorul mașinii (a cui mașină?), deci este în cazul Genitiv."
    },
    {
      "question": "Forma corectă de plural articulat pentru adjectivul „dragă” este:",
      "choices": ["Dragile mele", "Dragele mele"],
      "answerIndex": 1,
      "explanation": "Pluralul feminin nearticulat este „drage”; prin articulare devine „dragele”."
    },
    {
      "question": "Propoziția „Filmul este **de văzut**” conține un predicat:",
      "choices": ["Verbal", "Nominal", "Adverbial", "Interjecțional"],
      "answerIndex": 1,
      "explanation": "Format din verbul copulativ „este” + numele predicativ „de văzut” (verb la supin)."
    },
    {
      "question": "În fraza „Primul **care** a răspuns a primit nota zece”, cuvântul evidențiat este:",
      "choices": ["Adjectiv pronominal", "Pronume relativ", "Pronume interogativ", "Conjuncție"],
      "answerIndex": 1,
      "explanation": "„Care” face relația între propoziții și înlocuiește un substantiv sau numeral din regenta (antecedentul „primul”)."
    },
    {
      "question": "Expansiunea atributului din propoziția „Tema **scrisă** a fost corectată” este:",
      "choices": ["Tema de scris...", "Tema pe care am scris-o...", "Tema care a fost scrisă...", "Tema scriind..."],
      "answerIndex": 2,
      "explanation": "Atributul participial „scrisă” devine o propoziție atributivă pasivă introdusă prin „care”."
    },
    {
      "question": "În enunțul „I-am dat **Mariei** cartea”, substantivul propriu este în cazul:",
      "choices": ["Genitiv", "Dativ", "Acuzativ", "Vocativ"],
      "answerIndex": 1,
      "explanation": "Răspunde la întrebarea „cui i-am dat?”, deci este în cazul Dativ."
    },
    {
      "question": "Cuvintele **întreagă** și **jumătate** în contextul „O livadă întreagă... doar o jumătate” sunt:",
      "choices": ["Sinonime", "Antonime", "Paronime", "Omonime"],
      "answerIndex": 1,
      "explanation": "Ele exprimă idei opuse (totul vs o parte), fiind antonime."
    },
    {
      "question": "Verbul a fi în enunțul „Ana **este** la școală” are valoare:",
      "choices": ["Copulativă", "Predicativă", "Auxiliară", "Impersonală"],
      "answerIndex": 1,
      "explanation": "Aici „este” are sensul de „se află”, „există”, deci este predicativ (formează singur predicatul verbal)."
    },
    {
      "question": "Pronumele reflexiv are forme proprii (specifice) doar pentru:",
      "choices": ["Persoana I", "Persoana a II-a", "Persoana a III-a", "Toate persoanele"],
      "answerIndex": 2,
      "explanation": "Doar la persoana a III-a există forme precum „sie”, „sine”, „s-”, „își”. La restul persoanelor se folosesc formele pronumelui personal."
    },
    {
      "question": "Alege varianta corectă: „Nu **se merită** să te superi.” / „Nu **merită** să te superi.”",
      "choices": ["Nu se merită", "Nu merită"],
      "answerIndex": 1,
      "explanation": "Verbul „a merita” nu este reflexiv în limba română standard."
    }
  ];

  // === logică quiz ===
  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeLeftEl = document.getElementById("timeLeft");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  const DEFAULT_TIME_PER_Q = 30;

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME_PER_Q;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  function questionHasLink(text){
    // detectează link în paranteze: ( ... http... )
    return /\([^)]*https?:\/\/[^)]*\)/.test(text);
  }

  function setInfiniteTimerUI(){
    stopTimer();
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">∞</span>`;
    progressWrap.style.display = "none";
  }

  function startTimer(seconds){
    stopTimer();
    remaining = seconds;
    timeLeftEl.textContent = remaining;
    timeBar.style.width = "100%";
    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${remaining}</span>s`;

    timer = setInterval(() => {
      remaining -= 1;
      // re-select timeLeft element (fiindcă îl recreăm în innerHTML la fiecare întrebare)
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = remaining;

      const pct = (remaining / seconds) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function formatQuestionText(raw) {
    let text = raw;

    // 1) **text** -> <strong>text</strong>
    text = text.replace(/\*\*(.+?)\*\*/g, "<strong>$1</strong>");

    // 2) link în paranteze: ( ... https://... ) -> păstrează parantezele, fă link clicabil
    //    + "lasă spațiu între finalul link-ului și paranteză" => "URL </a> )"
    text = text.replace(/\(([^)]*?)(https?:\/\/\S+?)([^)]*?)\)/g, (m, before, url, after) => {
      const b = (before || "").trim();
      const a = (after || "").trim();
      const left = b ? b + " " : "";
      const right = a ? " " + a : "";
      return `(${left}<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a> ${right})`;
    });

    // 3) "Link text: URL" -> clicabil (și păstrează ",)" etc.)
    //    + spațiu între finalul link-ului și paranteză: ...</a> )
    text = text.replace(/Link text:\s*(https?:\/\/\S+)/g, (m, url) => {
      return `Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
    });

    return text;
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const hasLink = questionHasLink(q.question) || /Link text:\s*https?:\/\//.test(q.question);

    app.innerHTML = `
      <h2>${formatQuestionText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${c}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>${hasLink ? `Timp / întrebare: <code>∞</code>` : `Timp / întrebare: <code>${DEFAULT_TIME_PER_Q}s</code>`}</div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        const fb = document.getElementById("feedback");
        fb.innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    if (hasLink) {
      setInfiniteTimerUI();
    } else {
      // re-legăm timeLeftEl (fiindcă l-am recreat în timerBadge)
      startTimer(DEFAULT_TIME_PER_Q);
    }
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const fb = document.getElementById("feedback");
    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${q.choices[selectedIndex]}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    fb.innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${q.choices[correct]}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${q.explanation ?? "(fără explicație)"}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    document.getElementById("scoreNow").textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe quiz-ul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
