<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz – Set nou</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }
    a { color: inherit; text-decoration: underline; }
    .emph { font-weight: 700; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Quiz – Set nou</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">30</span>s</div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === Întrebări (JSON-ul tău) ===
  const questions = [
    {
      "question": "În enunțul „Îmi **place** cartea”, subiectul este: [Sursa 109]",
      "choices": ["Subînțeles (eu)", "Inclus (eu)", "Exprimat prin substantivul „cartea”", "Nedeterminat"],
      "answerIndex": 2,
      "explanation": "Verbul „a plăcea” permite un subiect non-uman postpus. Întrebarea „ce îmi place?” are răspunsul „cartea”, acesta fiind subiectul gramatical."
    },
    {
      "question": "Conform Programei și surselor de vocabular, cuvintele „îmbuna”, „bunătate”, „bunăstare” formează: [Sursa 123]",
      "choices": ["Un câmp lexical", "O familie lexicală", "O serie de sinonime", "O serie de antonime"],
      "answerIndex": 1,
      "explanation": "Familia lexicală cuprinde toate cuvintele formate de la aceeași rădăcină („bun”) prin derivare, compunere sau conversiune."
    },
    {
      "question": "Identifică funcția sintactică a cuvântului evidențiat: „Mă gândesc **la tine**.” [Sursa 89]",
      "choices": ["Complement direct", "Complement indirect", "Complement prepozițional", "Circumstanțial de loc"],
      "answerIndex": 2,
      "explanation": "Verbul „a se gândi” cere o prepoziție (la cine?), iar în noua programă, funcția sintactică pentru obiectul prepozițional (care nu e în Dativ) este Complementul Prepozițional."
    },
    {
      "question": "În textul dramatic, conflictul care se naște din interese sau sentimente opuse reprezintă: [Sursa 199]",
      "choices": ["Elementul fundamental al acțiunii", "O indicație scenică", "Un defect de structură", "O pauză între acte"],
      "answerIndex": 0,
      "explanation": "Conflictul dramatic (interior sau exterior) este motorul care declanșează și susține evoluția acțiunii într-o piesă de teatru."
    },
    {
      "question": "În cuvântul „el”, pronunțat [iel], există: [Sursa 128]",
      "choices": ["Un hiat", "Un diftong", "Un triftong", "Doar o vocală"],
      "answerIndex": 1,
      "explanation": "Pronumele personale care încep cu „e” (el, ea, ei, ele) se pronunță cu „ie” inițial, formând un diftong [ie]."
    },
    {
      "question": "Valoarea morfologică a cuvântului „**deasupra**” în propoziția „Avionul zboară **deasupra**” este: [Sursa 95]",
      "choices": ["Prepoziție", "Adverb de loc", "Substantiv", "Adjectiv"],
      "answerIndex": 1,
      "explanation": "Dacă nu este urmat de un substantiv (ex: deasupra casei - prepoziție), ci determină singur verbul, „deasupra” este adverb de loc."
    },
    {
      "question": "Transformă propoziția activă „Vântul a rupt creanga” în propoziție pasivă: [Sursa 117]",
      "choices": ["Creanga este ruptă de vânt.", "Creanga a fost ruptă de vânt.", "Creanga va fi ruptă de vânt.", "Creanga s-a rupt de la vânt."],
      "answerIndex": 1,
      "explanation": "Auxiliarul „a fi” din pasiv trebuie să păstreze timpul verbului activ (perfect compus: „a rupt” -> „a fost ruptă”)."
    },
    {
      "question": "Cuvântul „**ochelari**” este un substantiv: [Sursa 55]",
      "choices": ["Defectiv de plural", "Defectiv de singular", "Colectiv", "Propriu"],
      "answerIndex": 1,
      "explanation": "Substantivul „ochelari” se folosește doar la forma de plural (nu spunem „un ochelar”), fiind defectiv de singular."
    },
    {
      "question": "În fraza „Nu știam **unde a plecat**”, propoziția subordonată este: [Sursa 87]",
      "choices": ["Circumstanțială de loc", "Completivă Directă", "Atributivă", "Completivă Indirectă"],
      "answerIndex": 1,
      "explanation": "Verbul regent „nu știam” cere un complement direct (ce nu știam?). Răspunsul este propoziția „unde a plecat”."
    },
    {
      "question": "Valoarea culturală asociată cu textul „Micul Prinț” în materialele studiate este: [Sursa 82]",
      "choices": ["Curajul în luptă", "Dorința de explorare / cunoaștere", "Patriotismul", "Respectul față de animale"],
      "answerIndex": 1,
      "explanation": "Tabelul de valori asociază opera cu „dorința de explorare, cunoaștere și descoperirea sinelui”."
    },
    {
      "question": "Verbul „a fi” în enunțul „Cartea **este interesantă**” are valoare: [Sursa 151]",
      "choices": ["Predicativă", "Auxiliară", "Copulativă", "Impersonală"],
      "answerIndex": 2,
      "explanation": "Împreună cu numele predicativ „interesantă” (adjectiv), verbul „a fi” formează un predicat nominal, având valoare copulativă."
    },
    {
      "question": "Conform regulilor de punctuație, conjuncția adversativă „**dar**” cere: [Sursa 186]",
      "choices": ["Virgulă înainte", "Virgulă după", "Nu cere virgulă", "Punct și virgulă după"],
      "answerIndex": 0,
      "explanation": "Toate conjuncțiile coordonatoare adversative (dar, iar, însă, ci) cer obligatoriu virgulă înaintea lor."
    },
    {
      "question": "Figura de stil din versul „Credința-i val, iubirea vânt” (G. Coșbuc) este: [Sursa 131]",
      "choices": ["Comparație", "Metaforă", "Epitet", "Personificare"],
      "answerIndex": 1,
      "explanation": "Este o metaforă (definiție implicită), deoarece lipsește termenul de legătură specific comparației (ex: „ca un val”), realizând o identificare directă."
    },
    {
      "question": "În propoziția „Se aude **tunând**”, cuvântul evidențiat este: [Sursa 2]",
      "choices": ["Verb la gerunziu (predicat verbal)", "Verb la gerunziu (subiect)", "Adjectiv", "Adverb"],
      "answerIndex": 0,
      "explanation": "În această construcție, gerunziul nu se acordă și funcționează ca predicat al unei propoziții subordonate sau element predicativ."
    },
    {
      "question": "Cuvintele „**blană**” (cu sensul de „foarte bun”) sau „**nașpa**” aparțin registrului: [Sursa 143]",
      "choices": ["Standard", "Solemn", "Argou", "Regional"],
      "answerIndex": 2,
      "explanation": "Sunt cuvinte codificate, folosite de grupuri restrânse (tineri/elevi) pentru a se diferenția, specifice argoului."
    },
    {
      "question": "În enunțul „Am o carte **de citit**”, structura evidențiată este: [Sursa 99]",
      "choices": ["Verb la supin, funcție de atribut verbal", "Verb la infinitiv, funcție de complement", "Adjectiv, funcție de atribut adjectival", "Verb la participiu"],
      "answerIndex": 0,
      "explanation": "Verbul la supin (prepoziție + participiu) determină substantivul „carte”, având funcția de atribut verbal."
    },
    {
      "question": "Procedeul prin care adjectivul „frumos” devine substantiv în „**Frumosul** atrage privirile” se numește: [Sursa 202]",
      "choices": ["Derivare", "Compunere", "Conversiune", "Flexiune"],
      "answerIndex": 2,
      "explanation": "Schimbarea valorii gramaticale prin articulare (fără modificarea formei) este conversiune."
    },
    {
      "question": "În versurile „Și te-ai dus, dulce minune, / Ș-a murit iubirea noastră” (M. Eminescu), mărcile eului liric sunt: [Sursa 71]",
      "choices": ["Verbele la persoana a III-a", "Adjectivul posesiv „noastră”", "Substantivul „minune”", "Verbul „a murit”"],
      "answerIndex": 1,
      "explanation": "Adjectivul pronominal posesiv de persoana I („noastră”) indică prezența și implicarea afectivă a eului liric."
    },
    {
      "question": "Conform DOOM3, forma corectă de indicativ prezent, persoana I plural a verbului „a crea” este: [Sursa 91]",
      "choices": ["Creem", "Creăm", "Crim", "Creiem"],
      "answerIndex": 1,
      "explanation": "Verbul „a crea” se conjugă după modelul „a lucra” (lucrăm -> creăm)."
    },
    {
      "question": "Rima în care versurile rimează în perechi (1 cu 2, 3 cu 4) se numește: [Sursa 192]",
      "choices": ["Încrucișată", "Îmbrățișată", "Împerecheată", "Monorimă"],
      "answerIndex": 2,
      "explanation": "Schema AABB este specifică rimei împerecheate."
    },
    {
      "question": "Pronumele reflexiv are forme proprii doar pentru: [Sursa 94]",
      "choices": ["Persoana I", "Persoana a II-a", "Persoana a III-a", "Toate persoanele"],
      "answerIndex": 2,
      "explanation": "Doar la persoana a III-a există forme specifice (sie, sine, își, se). La persoana I și a II-a împrumută formele pronumelui personal."
    },
    {
      "question": "Tiparul textual care prezintă caracteristicile unui obiect, personaj sau peisaj se numește: [Sursa 165]",
      "choices": ["Narativ", "Descriptiv", "Dialogat", "Argumentativ"],
      "answerIndex": 1,
      "explanation": "Textul descriptiv are rolul de a prezenta trăsături și detalii vizuale/senzoriale ale unui referent."
    },
    {
      "question": "În propoziția „**A** începe școala e o bucurie”, litera „A” este: [Sursa 152]",
      "choices": ["Prepoziție marcă a infinitivului", "Verb auxiliar", "Articol posesiv", "Interjecție"],
      "answerIndex": 0,
      "explanation": "Particula „a” care precede forma de dicționar a verbului este marca modului Infinitiv."
    },
    {
      "question": "Care este rolul cratimei în structura „m-am dus”? [Sursa 192]",
      "choices": ["Leagă două substantive", "Marchează rostirea într-o singură silabă a două părți de vorbire diferite", "Este o greșeală de tipar", "Desparte două vocale în hiat"],
      "answerIndex": 1,
      "explanation": "Cratima marchează elidarea vocalei și pronunțarea legată (sinalefa) a pronumelui „m” și a auxiliarului „am”."
    },
    {
      "question": "În fraza „Elevul **care** învață reușește”, cuvântul evidențiat este: [Sursa 93]",
      "choices": ["Pronume interogativ", "Adjectiv pronominal relativ", "Pronume relativ", "Conjuncție"],
      "answerIndex": 2,
      "explanation": "Face legătura între propoziții și înlocuiește substantivul „elevul” în subordonată, fiind pronume relativ."
    }
  ];

  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  const DEFAULT_TIME_PER_Q = 30;

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME_PER_Q;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  // doar întrebările cu "Link text:" au timp infinit (condiția anterioară)
  function questionHasLinkText(q) {
    return /Link text:\s*https?:\/\/[^\s)]+/.test(q);
  }

  function setInfiniteTimerUI(){
    stopTimer();
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">∞</span>`;
    progressWrap.style.display = "none";
  }

  function startTimer(seconds){
    stopTimer();
    remaining = seconds;
    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${remaining}</span>s`;
    timeBar.style.width = "100%";

    timer = setInterval(() => {
      remaining -= 1;
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = remaining;

      const pct = (remaining / seconds) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function escapeHtml(s){
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function formatQuestionText(raw) {
    let text = escapeHtml(raw);

    // **...** -> bold + underline
    text = text.replace(/\*\*(.+?)\*\*/g, '<span class="emph">$1</span>');

    // (Link text: URL) -> link + spațiu înainte de ")"
    text = text.replace(
      /\(Link text:\s*(https?:\/\/[^\s)]+)\)/g,
      (m, url) => `(Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a> )`
    );

    // Link text: URL (cu punctuație după) -> link
    text = text.replace(
      /Link text:\s*(https?:\/\/[^\s),.]+)([),.]?)/g,
      (m, url, punct) => `Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>${punct || ""}`
    );

    return text;
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const hasLink = questionHasLinkText(q.question);

    app.innerHTML = `
      <h2>${formatQuestionText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${escapeHtml(c)}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>${hasLink ? `Timp / întrebare: <code>∞</code>` : `Timp / întrebare: <code>${DEFAULT_TIME_PER_Q}s</code>`}</div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        document.getElementById("feedback").innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    if (hasLink) setInfiniteTimerUI();
    else startTimer(DEFAULT_TIME_PER_Q);
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${escapeHtml(q.choices[selectedIndex])}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    document.getElementById("feedback").innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${escapeHtml(q.choices[correct])}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${escapeHtml(q.explanation ?? "(fără explicație)")}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    document.getElementById("scoreNow").textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe quiz-ul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
