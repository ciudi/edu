<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz – Set nou</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }
    a { color: inherit; text-decoration: underline; }
    .emph { font-weight: 700; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Quiz – Set nou</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">30</span>s</div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === Întrebări (JSON-ul tău) ===
  const questions = [
    {
      "question": "În versurile „Vreme trece, vreme vine / Toate-s vechi și nouă-s toate” (Mihai Eminescu), figura de stil identificată este: [Sursa 13]",
      "choices": ["Antiteza", "Hiperbola", "Enumerația", "Aliterația"],
      "answerIndex": 0,
      "explanation": "Antiteza este procedeul artistic prin care se pun în opoziție două situații, noțiuni sau fenomene (trece/vine, vechi/nouă)."
    },
    {
      "question": "Conform regulilor fonetice, în cuvântul „gheata”, grupul de litere „ghe” notează: [Sursa 169]",
      "choices": ["Două sunete [g] și [e]", "Un singur sunet [g']", "Trei sunete", "Niciun sunet"],
      "answerIndex": 1,
      "explanation": "Grupul „ghe” urmat de vocala „a” în aceeași silabă notează un singur sunet (consoana [g']). Litera „e” este doar literă ajutătoare."
    },
    {
      "question": "Fenomenul definit ca „o conduită de evaziune definitivă tradusă prin încetarea frecventării școlii” este: [Sursa 124]",
      "choices": ["Absenteismul", "Fuga de la școală", "Abandonul școlar", "Vandalismul"],
      "answerIndex": 2,
      "explanation": "Sursa definește abandonul școlar ca părăsirea sistemului educativ înainte de finalizarea ciclului de studii, spre deosebire de absenteism care poate fi temporar."
    },
    {
      "question": "Transformă construcția activă „Elevii citesc cartea” în construcție pasivă: [Sursa 87]",
      "choices": ["Cartea a fost citită de elevi.", "Cartea este citită de elevi.", "Cartea va fi citită de elevi.", "Cartea e citită de către elevi."],
      "answerIndex": 1,
      "explanation": "La transformarea în pasiv, verbul auxiliar „a fi” păstrează timpul și modul verbului activ (prezent -> „este citită”)."
    },
    {
      "question": "În enunțul „**Tânărul** de ieri a fost amabil”, cuvântul evidențiat s-a format prin conversiune din: [Sursa 90]",
      "choices": ["Verb la participiu", "Adjectiv", "Adverb", "Pronume"],
      "answerIndex": 1,
      "explanation": "Adjectivul „tânăr” a devenit substantiv prin articulare cu articolul hotărât „-ul”."
    },
    {
      "question": "Cuvântul argotic „nașpa” s-a format prin: [Sursa 188]",
      "choices": ["Derivare cu sufix", "Compunere", "Trunchiere", "Împrumut direct"],
      "answerIndex": 2,
      "explanation": "Termenul provine din trunchierea (scurtarea) cuvântului „nașparliu”."
    },
    {
      "question": "În propoziția „**Uite**-o pe Ioana!”, cuvântul evidențiat este: [Sursa 177]",
      "choices": ["Verb la imperativ", "Adverb de loc", "Interjecție predicativă", "Prepoziție"],
      "answerIndex": 2,
      "explanation": "Interjecția „uite” îndeplinește funcția de predicat verbal, comportându-se ca un verb."
    },
    {
      "question": "Valoarea culturală asociată cu nuvela „Popa Tanda” de Ioan Slavici în tabelul de valori este: [Sursa 52]",
      "choices": ["Iubirea de natură", "Responsabilitatea față de ceilalți", "Curajul în luptă", "Pasiunea pentru cărți"],
      "answerIndex": 1,
      "explanation": "Tabelul asociază textul cu „responsabilitatea față de ceilalți” și spiritul comunitar."
    },
    {
      "question": "Expresia „la paștele cailor” este o: [Sursa 68]",
      "choices": ["Locuțiune verbală", "Locuțiune adverbială", "Locuțiune substantivală", "Metaforă poetică"],
      "answerIndex": 1,
      "explanation": "Este un grup unitar de cuvinte care funcționează ca un adverb (echivalent cu „niciodată”)."
    },
    {
      "question": "În sintagma „coșuri **fumegânde**”, cuvântul evidențiat este: [Sursa 226]",
      "choices": ["Verb la gerunziu", "Adjectiv provenit din gerunziu", "Adverb", "Substantiv"],
      "answerIndex": 1,
      "explanation": "Gerunziul acordat cu substantivul („coșuri” - plural) devine adjectiv prin conversiune."
    },
    {
      "question": "Care dintre următoarele verbe este **întotdeauna** impersonal? [Sursa 77]",
      "choices": ["A merge", "A ploua", "A face", "A citi"],
      "answerIndex": 1,
      "explanation": "Verbele care exprimă fenomene ale naturii (a ploua, a ninge, a tuna) sunt unipersonale prin formă și impersonale prin conținut."
    },
    {
      "question": "În versurile „Anii tăi se par ca clipe / Clipe dulci se par ca veacuri”, timpul este perceput: [Sursa 191]",
      "choices": ["Obiectiv", "Subiectiv", "Cronologic", "Istoric"],
      "answerIndex": 1,
      "explanation": "Comparația sugerează relativitatea timpului în funcție de starea sufletească (timpul subiectiv)."
    },
    {
      "question": "Poezia „Izvorul nopții” de Lucian Blaga aparține curentului: [Sursa 207]",
      "choices": ["Romantism", "Modernism", "Pașoptism", "Realism"],
      "answerIndex": 1,
      "explanation": "Fișa de studiu încadrează poezia în Modernism, caracterizat prin versificație liberă și metafore revelatorii."
    },
    {
      "question": "În propoziția „**Sau** înveți, **sau** mergi la plimbare”, virgula se folosește deoarece: [Sursa 205]",
      "choices": ["Conjuncțiile disjunctive sunt pereche", "Este o greșeală", "Propozițiile sunt subordonate", "Este o enumerare de substantive"],
      "answerIndex": 0,
      "explanation": "Când conjuncțiile disjunctive (sau... sau) sunt folosite în pereche, virgula este obligatorie înainte de al doilea termen."
    },
    {
      "question": "Care este forma corectă a verbului „a crea” la persoana I plural, indicativ prezent? [Sursa 61]",
      "choices": ["Noi creem", "Noi creăm", "Noi crim", "Noi creiem"],
      "answerIndex": 1,
      "explanation": "Urmează modelul „a lucra” -> „lucrăm”, deci „creăm” (nu „creem”)."
    },
    {
      "question": "Un text dramatic este împărțit în secvențe mari numite: [Sursa 213]",
      "choices": ["Tablouri", "Acte", "Scene", "Replici"],
      "answerIndex": 1,
      "explanation": "Actul este subdiviziunea principală, marcată de obicei prin lăsarea cortinei."
    },
    {
      "question": "Cuvântul „**bine**” în enunțul „El a făcut un **bine**” este: [Sursa 90]",
      "choices": ["Adverb", "Adjectiv", "Substantiv", "Interjecție"],
      "answerIndex": 2,
      "explanation": "Prin articulare cu „un”, adverbul „bine” a devenit substantiv (conversiune)."
    },
    {
      "question": "Conform sursei despre devianță, **copiatul** este considerat: [Sursa 108]",
      "choices": ["O formă de adaptare școlară", "O formă specifică de înșelăciune", "O metodă eficientă de învățare", "Un drept al elevului"],
      "answerIndex": 1,
      "explanation": "Textul definește copiatul ca o formă de înșelăciune prin care elevul prezintă cunoștințe neasimilate ca fiind proprii."
    },
    {
      "question": "În propoziția „Mă **ustură** în gât”, verbul este: [Sursa 78]",
      "choices": ["Personal", "Impersonal", "Reflexiv", "Copulativ"],
      "answerIndex": 1,
      "explanation": "Verbul nu are un subiect care face acțiunea (cine ustură?), fiind o construcție impersonală care exprimă o senzație."
    },
    {
      "question": "Rimă în care se potrivesc doar vocalele, nu și consoanele (ex: *creștet – veșted*), se numește: [Sursa 211]",
      "choices": ["Rimă albă", "Rimă imperfectă (asonanță)", "Rimă încrucișată", "Monorimă"],
      "answerIndex": 1,
      "explanation": "Această potrivire parțială a sunetelor finale este definită ca rimă imperfectă."
    },
    {
      "question": "Neologismul „smartphone” este un împrumut din limba: [Sursa 182]",
      "choices": ["Franceză", "Germană", "Engleză", "Italiană"],
      "answerIndex": 2,
      "explanation": "Conform listei de neologisme recente, termenii tehnologici precum smartphone, design, weekend provin din engleză."
    },
    {
      "question": "În fraza „Cartea **pe care** am citit-o este interesantă”, secvența evidențiată este o propoziție: [Sursa 50]",
      "choices": ["Completivă directă", "Atributivă", "Subiectivă", "Circumstanțială de timp"],
      "answerIndex": 1,
      "explanation": "Propoziția determină substantivul „cartea” (care carte?), fiind o subordonată atributivă."
    },
    {
      "question": "Figura de stil din versul „Argintu **mușcă** iarba” (Șt. A. Doinaș) este: [Sursa 174]",
      "choices": ["Comparație", "Personificare", "Epitet", "Repetiție"],
      "answerIndex": 1,
      "explanation": "Atribuirea acțiunii umane „a mușca” unui element neînsuflețit (lumina lunii/argintul) este o personificare."
    },
    {
      "question": "În enunțul „Elevii **au fost ajutați** de profesori”, verbul „a fi” este: [Sursa 195]",
      "choices": ["Predicativ", "Copulativ", "Auxiliar", "Impersonal"],
      "answerIndex": 2,
      "explanation": "Ajută la formarea diatezei pasive (a fost + participiu), deci are valoare de verb auxiliar."
    },
    {
      "question": "În cuvântul „fiind”, grupul de sunete „ii” formează un: [Sursa 172]",
      "choices": ["Diftong", "Triftong", "Hiat", "Nu formează grup vocalic"],
      "answerIndex": 2,
      "explanation": "Cele două vocale „i” sunt pronunțate în silabe diferite (fi-ind), formând un hiat."
    }
  ];

  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  const DEFAULT_TIME_PER_Q = 30;

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME_PER_Q;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  // doar întrebările cu "Link text:" au timp infinit (condiția anterioară)
  function questionHasLinkText(q) {
    return /Link text:\s*https?:\/\/[^\s)]+/.test(q);
  }

  function setInfiniteTimerUI(){
    stopTimer();
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">∞</span>`;
    progressWrap.style.display = "none";
  }

  function startTimer(seconds){
    stopTimer();
    remaining = seconds;
    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${remaining}</span>s`;
    timeBar.style.width = "100%";

    timer = setInterval(() => {
      remaining -= 1;
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = remaining;

      const pct = (remaining / seconds) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function escapeHtml(s){
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function formatQuestionText(raw) {
    let text = escapeHtml(raw);

    // **...** -> bold + underline
    text = text.replace(/\*\*(.+?)\*\*/g, '<span class="emph">$1</span>');

    // (Link text: URL) -> link + spațiu înainte de ")"
    text = text.replace(
      /\(Link text:\s*(https?:\/\/[^\s)]+)\)/g,
      (m, url) => `(Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a> )`
    );

    // Link text: URL (cu punctuație după) -> link
    text = text.replace(
      /Link text:\s*(https?:\/\/[^\s),.]+)([),.]?)/g,
      (m, url, punct) => `Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>${punct || ""}`
    );

    return text;
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const hasLink = questionHasLinkText(q.question);

    app.innerHTML = `
      <h2>${formatQuestionText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${escapeHtml(c)}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>${hasLink ? `Timp / întrebare: <code>∞</code>` : `Timp / întrebare: <code>${DEFAULT_TIME_PER_Q}s</code>`}</div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        document.getElementById("feedback").innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    if (hasLink) setInfiniteTimerUI();
    else startTimer(DEFAULT_TIME_PER_Q);
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${escapeHtml(q.choices[selectedIndex])}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    document.getElementById("feedback").innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${escapeHtml(q.choices[correct])}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${escapeHtml(q.explanation ?? "(fără explicație)")}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    document.getElementById("scoreNow").textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe quiz-ul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
