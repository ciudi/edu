<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Limba Română</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 980px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }

    /* cerință: cuvintele între ** ** -> bold + underline */
    .emph { font-weight: 700; text-decoration: underline; }

    /* link-uri vizibile */
    a { color: #0b57d0; text-decoration: underline; }
    a:hover { opacity: .85; }
  </style>
</head>
<body>

<h1>Quiz Limba Română</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">00:30</span></div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === Întrebări (JSON-ul tău) ===
  const questions = [
    {
      "question": "Conform surselor de teorie literară, indicațiile scenice (didascaliile) reprezintă: [Sursa 195]",
      "choices": ["Partea literară a textului dramatic", "Dialogul personajelor", "Partea nonliterară a textului dramatic", "Monologul interior"],
      "answerIndex": 2,
      "explanation": "Didascaliile sunt instrucțiunile autorului pentru regizor și actori (decor, joc scenic), fiind considerate partea nonliterară a operei dramatice."
    },
    {
      "question": "În enunțul „Tânărul de ieri a fost amabil”, cuvântul „Tânărul” s-a format prin: [Sursa 120]",
      "choices": ["Derivare cu sufix", "Compunere", "Conversiune (schimbarea valorii gramaticale)", "Împrumut lexical"],
      "answerIndex": 2,
      "explanation": "Adjectivul „tânăr” a devenit substantiv prin articulare cu articolul hotărât „-l”, proces denumit conversiune."
    },
    {
      "question": "Identifică valoarea morfologică a verbului „a fi” în propoziția: „El este doctor”. [Sursa 151]",
      "choices": ["Verb auxiliar", "Verb copulativ", "Verb predicativ", "Verb impersonal"],
      "answerIndex": 1,
      "explanation": "Împreună cu numele predicativ „doctor”, verbul „a fi” formează un predicat nominal, având valoare copulativă (nu are sensul de „a exista”)."
    },
    {
      "question": "Figura de stil din versul „Argintu mușcă iarba” (Șt. A. Doinaș) este: [Sursa 131]",
      "choices": ["Comparație", "Epitet", "Personificare", "Repetiție"],
      "answerIndex": 2,
      "explanation": "Se atribuie o acțiune specifică unei ființe vii („mușcă”) unui element neînsuflețit (lumina lunii/argintul), realizând o personificare."
    },
    {
      "question": "În sintagma „coșuri fumegânde”, cuvântul „fumegânde” este: [Sursa 122]",
      "choices": ["Verb la gerunziu", "Adjectiv provenit din gerunziu", "Adverb de mod", "Substantiv"],
      "answerIndex": 1,
      "explanation": "Verbul la gerunziu se acordă în gen, număr și caz cu substantivul determinat („coșuri”), devenind adjectiv prin conversiune."
    },
    {
      "question": "Conform regulilor de punctuație din surse, conjuncția coordonatoare adversativă „dar” cere: [Sursa 186]",
      "choices": ["Virgulă înainte", "Virgulă după", "Nu cere virgulă", "Punct și virgulă după"],
      "answerIndex": 0,
      "explanation": "Toate conjuncțiile coordonatoare adversative (dar, iar, însă, ci) cer obligatoriu virgulă înaintea lor."
    },
    {
      "question": "Termenul argotic „nașpa” s-a format prin: [Sursa 145]",
      "choices": ["Derivare", "Compunere", "Trunchiere", "Împrumut"],
      "answerIndex": 2,
      "explanation": "Sursa indică faptul că provine din trunchierea (scurtarea) cuvântului „nașparliu”."
    },
    {
      "question": "Poezia „Izvorul nopții” de Lucian Blaga este încadrată în curentul literar: [Sursa 188]",
      "choices": ["Romantism", "Modernism", "Clasicism", "Realism"],
      "answerIndex": 1,
      "explanation": "Fișa de studiu o asociază modernismului, caracterizat prin versificație liberă și metafore revelatorii."
    },
    {
      "question": "În construcția pasivă „Cartea este citită de elevi”, subiectul gramatical este: [Sursa 117]",
      "choices": ["Elevii", "De elevi", "Cartea", "Este citită"],
      "answerIndex": 2,
      "explanation": "În diateza pasivă, complementul direct din propoziția activă („cartea”) devine subiectul care suportă acțiunea."
    },
    {
      "question": "Cuvintele „îmbuna”, „bunătate”, „bunăstare” formează pentru cuvântul „bun”: [Sursa 124]",
      "choices": ["Un câmp lexical", "O familie lexicală", "O serie de sinonime", "O serie de omonime"],
      "answerIndex": 1,
      "explanation": "Sunt cuvinte formate de la aceeași rădăcină („bun”) prin derivare, compunere sau conversiune, constituind familia lexicală."
    },
    {
      "question": "Verbele care exprimă fenomene ale naturii (plouă, ninge, tună) sunt: [Sursa 107]",
      "choices": ["Personale", "Impersonale", "Reflexive", "Copulative"],
      "answerIndex": 1,
      "explanation": "Aceste verbe nu au un subiect care face acțiunea (nu sunt făcute de o persoană), fiind prin excelență impersonale."
    },
    {
      "question": "Valoarea culturală asociată cu „Povestea lui Harap-Alb” în tabelul de valori este: [Sursa 82]",
      "choices": ["Iubirea de natură", "Curajul și asumarea responsabilităților", "Pasiunea pentru cărți", "Relația om-animal"],
      "answerIndex": 1,
      "explanation": "Tabelul asociază basmul lui Ion Creangă cu valoarea morală a curajului și a asumării responsabilității."
    },
    {
      "question": "În enunțul „Lunea merg la școală”, cuvântul „Lunea” este: [Sursa 123]",
      "choices": ["Substantiv", "Numeral", "Adverb de timp", "Adjectiv"],
      "answerIndex": 2,
      "explanation": "Denumirea zilei, folosită pentru a indica timpul (când? - repetabilitate), devine adverb prin conversiune."
    },
    {
      "question": "Diftongul este grupul de sunete alcătuit din: [Sursa 128]",
      "choices": ["Două vocale", "O vocală și o semivocală în aceeași silabă", "Două consoane", "O vocală și o semivocală în silabe diferite"],
      "answerIndex": 1,
      "explanation": "Definiția corectă a diftongului implică o vocală și o semivocală pronunțate într-o singură emisie de voce (aceeași silabă)."
    },
    {
      "question": "Registrul de limbă caracterizat prin termeni precum „profu'”, „domne” și căderi de sunete este: [Sursa 142]",
      "choices": ["Solemn", "Standard", "Familiar (colocvial)", "Tehnic"],
      "answerIndex": 2,
      "explanation": "Aceste elemente de oralitate, relaxare a normelor și adresare directă sunt specifice registrului familiar."
    },
    {
      "question": "Aliterația este figura de stil care constă în: [Sursa 131]",
      "choices": ["Repetarea unor vocale", "Repetarea unor consoane pentru efect sonor", "Exagerarea unei trăsături", "Atribuirea de însușiri umane"],
      "answerIndex": 1,
      "explanation": "Repetarea consoanelor (ex: „Vâjâind ca vijelia”) cu intenție imitativă sau expresivă definește aliterația."
    },
    {
      "question": "În fraza „Am învățat, deci știu”, conjuncția „deci” este: [Sursa 186]",
      "choices": ["Copulativă", "Adversativă", "Concluzivă", "Disjunctivă"],
      "answerIndex": 2,
      "explanation": "Introduce o propoziție care exprimă urmarea sau concluzia acțiunii anterioare."
    },
    {
      "question": "Forma corectă a verbului „a crea” la persoana I plural, indicativ prezent este: [Sursa 91]",
      "choices": ["Creem", "Creăm", "Crim", "Creiem"],
      "answerIndex": 1,
      "explanation": "Verbul „a crea” se conjugă după modelul verbului „a lucra” (lucrăm -> creăm)."
    },
    {
      "question": "Subdiviziunea textului dramatic delimitată de intrarea sau ieșirea unui personaj se numește: [Sursa 194]",
      "choices": ["Act", "Scenă", "Replica", "Didascalie"],
      "answerIndex": 1,
      "explanation": "Schimbarea configurației personajelor pe scenă marchează trecerea la o nouă scenă."
    },
    {
      "question": "În enunțul „Hai acasă!”, cuvântul „Hai” este: [Sursa 134]",
      "choices": ["Verb la imperativ", "Adverb", "Interjecție predicativă", "Substantiv"],
      "answerIndex": 2,
      "explanation": "Interjecția „hai” îndeplinește funcția de predicat verbal, comportându-se ca un verb, deci este interjecție predicativă."
    },
    {
      "question": "Cuvântul „cefalee” (durere de cap) aparține: [Sursa 147]",
      "choices": ["Argoului", "Limbajului popular", "Jargonului medical", "Registrului familiar"],
      "answerIndex": 2,
      "explanation": "Este un termen specializat folosit de medici, specific jargonului (limbajului de specialitate)."
    },
    {
      "question": "Pronumele reflexiv are forme proprii doar pentru: [Sursa 94]",
      "choices": ["Persoana I", "Persoana a II-a", "Persoana a III-a", "Toate persoanele"],
      "answerIndex": 2,
      "explanation": "Doar la persoana a III-a există forme specifice (sie, sine, își, se); la restul persoanelor împrumută formele pronumelui personal."
    },
    {
      "question": "În expresia „la paștele cailor”, structura este o: [Sursa 98]",
      "choices": ["Locuțiune verbală", "Locuțiune adverbială", "Metaforă", "Locuțiune substantivală"],
      "answerIndex": 1,
      "explanation": "Grupul de cuvinte are înțeles unitar și este echivalent cu adverbul „niciodată”."
    },
    {
      "question": "Subiectul gramatical al propoziției „Îmi place cartea” este: [Sursa 109]",
      "choices": ["Inclus (eu)", "Subînțeles", "Cartea", "Nedeterminat"],
      "answerIndex": 2,
      "explanation": "Deși subiectul logic este persoana care place (eu), gramatical, verbul se acordă cu „cartea” (ea place), care este subiectul."
    },
    {
      "question": "În versurile „Anii tăi se par ca clipe”, figura de stil este: [Sursa 131]",
      "choices": ["Metafora", "Comparația", "Epitetul", "Hiperbola"],
      "answerIndex": 1,
      "explanation": "Prezența termenului de legătură „ca” indică o comparație explicită între „ani” și „clipe”."
    }
  ];

  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  // === CERINȚE QUIZ LIMBA ROMÂNĂ ===
  // - 30 secunde / întrebare
  // - excepție: întrebările care AU link (în paranteze de tip "Link text: https://...") -> timp infinit
  const DEFAULT_TIME_PER_Q = 30; // sec
  const INFINITE = null;

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME_PER_Q;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  function escapeHtml(s){
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  // Cerințe formatare:
  // - **...** => bold + underline
  // - Link-urile din (Link text: https://...) să fie clickable
  // - Spațiu între finalul linkului și paranteza închisă: ".../wiki/X )"
  function formatText(raw) {
    let text = escapeHtml(raw);

    // (Link text: URL) => (Link text: <a href="URL">URL</a> )
    // + spațiu înainte de ")"
    text = text.replace(/\(Link text:\s*(https?:\/\/[^\s)]+)\s*\)/g, (m, url) => {
      const safeUrl = url; // already escaped
      return `(Link text: <a href="${safeUrl}" target="_blank" rel="noopener noreferrer">${safeUrl}</a> )`;
    });

    // orice URL rămas (dacă apare) -> link
    text = text.replace(/(https?:\/\/[^\s<)]+)/g, (m, url) => {
      // dacă e deja în href, evităm dublarea (simplu: nu linkuim dacă apare 'href=' înainte foarte aproape)
      return `<a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>`;
    });

    // **...** => bold + underline
    text = text.replace(/\*\*(.+?)\*\*/g, '<span class="emph">$1</span>');

    return text;
  }

  function hasReferenceLink(questionText) {
    // considerăm "are link" dacă există "Link text:" sau un URL explicit
    return /(Link text:)/i.test(questionText) || /(https?:\/\/)/i.test(questionText);
  }

  function fmtTime(seconds){
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
  }

  function startTimer(secondsOrNull){
    stopTimer();

    if (secondsOrNull === INFINITE) {
      // timp infinit
      progressWrap.style.display = "none";
      timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">∞</span>`;
      return;
    }

    const seconds = secondsOrNull;
    remaining = seconds;
    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${fmtTime(remaining)}</span>`;
    timeBar.style.width = "100%";

    timer = setInterval(() => {
      remaining -= 1;
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = fmtTime(Math.max(remaining, 0));

      const pct = (remaining / seconds) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const timeForThis = hasReferenceLink(q.question) ? INFINITE : DEFAULT_TIME_PER_Q;

    app.innerHTML = `
      <h2>${formatText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${formatText(c)}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>Timp / întrebare: <code>${timeForThis === INFINITE ? "∞" : fmtTime(timeForThis)}</code></div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        document.getElementById("feedback").innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    startTimer(timeForThis);
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${formatText(q.choices[selectedIndex])}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    document.getElementById("feedback").innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${formatText(q.choices[correct])}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${formatText(q.explanation || "(fără explicație)")}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    const scoreNow = document.getElementById("scoreNow");
    if (scoreNow) scoreNow.textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe quiz-ul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
