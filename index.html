<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz – Set nou</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }
    a { color: inherit; text-decoration: underline; }
    .emph { font-weight: 700; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Quiz – Set nou</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">30</span>s</div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === Întrebări (JSON-ul tău) ===
  const questions = [
    {
      "question": "În cuvântul „excursie”, litera **x** notează sunetele: [Sursa 168]",
      "choices": ["[gz]", "[cs]", "[ks]", "[kz]"],
      "answerIndex": 2,
      "explanation": "Litera „x” se pronunță [ks] în cuvinte precum „excursie”, „fix”, „axă” și [gz] în cuvinte precum „examen” sau „exercițiu”."
    },
    {
      "question": "Conform regulilor de formare a genitivului, forma corectă pentru „mamă-soacră” este: [Sursa 31]",
      "choices": ["Mamii-soacre", "Mamei-soacre", "Mamei-soacrei", "Mama-soacrei"],
      "answerIndex": 1,
      "explanation": "La substantivele compuse prin cratimă, se articulează primul termen: „mamei-soacre” (nu „mamii” și nu se articulează ambele)."
    },
    {
      "question": "În propoziția „**Hai** acasă!”, cuvântul evidențiat este: [Sursa 177]",
      "choices": ["Verb la imperativ", "Interjecție predicativă", "Adverb de mod", "Substantiv"],
      "answerIndex": 1,
      "explanation": "Interjecțiile precum „hai”, „uite”, „na” pot îndeplini funcția de predicat verbal, numindu-se interjecții predicative."
    },
    {
      "question": "În textul dramatic, o subdiviziune a piesei marcată de lăsarea cortinei se numește: [Sursa 213]",
      "choices": ["Scenă", "Tablou", "Act", "Replica"],
      "answerIndex": 2,
      "explanation": "Actul este subdiviziunea principală a unei opere dramatice, pauza dintre acte fiind marcată de obicei prin lăsarea cortinei."
    },
    {
      "question": "Verbul „a fi” în enunțul „Cartea **a fost citită** de elevi” are rolul de: [Sursa 85]",
      "choices": ["Verb copulativ", "Verb predicativ", "Verb auxiliar", "Verb impersonal"],
      "answerIndex": 2,
      "explanation": "În construcțiile pasive (a fost + participiu), verbul „a fi” este auxiliarul care ajută la formarea diatezei pasive."
    },
    {
      "question": "Cuvântul „weekend” este un neologism împrumutat din limba: [Sursa 182]",
      "choices": ["Franceză", "Engleză", "Germană", "Italiană"],
      "answerIndex": 1,
      "explanation": "Conform listei de împrumuturi recente, termenii precum „design”, „weekend”, „smartphone” provin din engleză."
    },
    {
      "question": "În fraza „Nu a învățat, **ci** a ghicit”, conjuncția „ci” este: [Sursa 204]",
      "choices": ["Copulativă", "Disjunctivă", "Adversativă", "Concluzivă"],
      "answerIndex": 2,
      "explanation": "Conjuncțiile „dar, iar, însă, ci” exprimă opoziția, fiind conjuncții coordonatoare adversative."
    },
    {
      "question": "Realizează contragerea subordonatei din fraza: „Cartea **pe care a cumpărat-o** Iulian este pe bancă.” [Sursa 50]",
      "choices": ["Cartea cumpărată de Iulian...", "Cartea de cumpărat...", "Cartea cumpărând...", "Cartea lui Iulian..."],
      "answerIndex": 0,
      "explanation": "Propoziția atributivă se reduce la un atribut adjectival (participial): „Cartea cumpărată de Iulian”."
    },
    {
      "question": "Pronumele „dumneavoastră” face parte din categoria: [Sursa 63]",
      "choices": ["Pronume personal de politețe", "Pronume demonstrativ", "Pronume nehotărât", "Pronume reflexiv"],
      "answerIndex": 0,
      "explanation": "Formele precum „dumneata”, „dumneavoastră” indică respectul și sunt clasificate ca pronume personale de politețe."
    },
    {
      "question": "Figura de stil care constă în repetarea unei consoane pentru efecte sonore (ex: „Vâjâind ca vijelia”) se numește: [Sursa 191]",
      "choices": ["Asonanță", "Aliterație", "Metaforă", "Oximoron"],
      "answerIndex": 1,
      "explanation": "Repetarea consoanelor cu intenție expresivă sau imitativă este definiția aliterației."
    },
    {
      "question": "În enunțul „Și-a spus **oful**”, cuvântul evidențiat s-a format prin conversiune din: [Sursa 221]",
      "choices": ["Verb", "Adjectiv", "Interjecție", "Adverb"],
      "answerIndex": 2,
      "explanation": "Interjecția „of” a devenit substantiv prin articulare („oful”), proces numit conversiune."
    },
    {
      "question": "Propoziția „Afară **plouă**” are subiect: [Sursa 200]",
      "choices": ["Exprimat", "Inclus", "Subînțeles", "Nu are subiect"],
      "answerIndex": 3,
      "explanation": "Verbele care exprimă fenomene meteorologice (plouă, ninge, tună) sunt impersonale și unipersonale prin formă; ele nu au subiect."
    },
    {
      "question": "Conform regulii de conjugare, forma corectă a verbului „a crea” la indicativ prezent, persoana a III-a singular este: [Sursa 61]",
      "choices": ["El crează", "El creează", "El creiază", "El crea"],
      "answerIndex": 1,
      "explanation": "Verbul „a crea” se conjugă păstrând rădăcina „cre-” + terminația „-ează”. Deci: „el creează” (doi 'e')."
    },
    {
      "question": "Rima în care se potrivesc doar vocalele de la sfârșitul versurilor, consoanele fiind diferite (ex: „creștet” – „veșted”), se numește: [Sursa 211]",
      "choices": ["Rimă albă", "Rimă imperfectă (asonanță)", "Monorimă", "Rimă încrucișată"],
      "answerIndex": 1,
      "explanation": "Potrivirea parțială a sunetelor finale (doar vocalele) constituie o rimă imperfectă."
    },
    {
      "question": "Utilizarea termenilor precum „profu'”, „domne” sau căderile de sunete („cuvântu'”) sunt specifice registrului: [Sursa 185]",
      "choices": ["Solemn", "Standard", "Familiar (colocvial)", "Tehnic"],
      "answerIndex": 2,
      "explanation": "Registrul familiar se caracterizează prin relaxarea regulilor, termeni populari și pronunție neglijentă."
    },
    {
      "question": "În enunțul „Mă **cheamă** Matei”, verbul este: [Sursa 78]",
      "choices": ["Personal", "Impersonal", "Reflexiv propriu-zis", "Auxiliar"],
      "answerIndex": 1,
      "explanation": "În această construcție, verbul nu are un subiect care face acțiunea (cine cheamă?), fiind considerat impersonal din punct de vedere semantic."
    },
    {
      "question": "Figura de stil din versul „Și vodă-i un **munte**” (G. Coșbuc) este: [Sursa 174]",
      "choices": ["Epitet", "Personificare", "Hiperbolă", "Antiteză"],
      "answerIndex": 2,
      "explanation": "Exagerarea dimensiunilor personajului pentru a-i evidenția măreția este o hiperbolă."
    },
    {
      "question": "Forma ortografică corectă a condiționalului optativ, persoana I singular, este: [Sursa 15]",
      "choices": ["Ași dori", "Aș dori", "A-și dori", "Aș dorii"],
      "answerIndex": 1,
      "explanation": "Auxiliarul condiționalului pentru persoana I este „aș”. Forma „ași” este greșită."
    },
    {
      "question": "În enunțul „**Lunea** merg la școală”, cuvântul evidențiat este: [Sursa 229]",
      "choices": ["Substantiv", "Adverb de timp", "Adjectiv", "Numeral"],
      "answerIndex": 1,
      "explanation": "Deși provine dintr-un substantiv, aici indică timpul și repetabilitatea acțiunii, devenind adverb prin conversiune."
    },
    {
      "question": "În enunțul „Eu **mă** laud”, pronumele „mă” este: [Sursa 64]",
      "choices": ["Personal", "Reflexiv", "Posesiv", "Nehotărât"],
      "answerIndex": 1,
      "explanation": "Subiectul (Eu) face acțiunea și tot el o suportă (pe sine). Persoana subiectului coincide cu a pronumelui -> Reflexiv."
    },
    {
      "question": "Mărcile lexico-gramaticale ale prezenței **eului liric** într-un text sunt: [Sursa 41]",
      "choices": ["Verbe și pronume la persoana a III-a", "Verbe și pronume la persoana I", "Dialogul", "Didascaliile"],
      "answerIndex": 1,
      "explanation": "Persoana I (singular sau plural) la verbe și pronume indică subiectivitatea și prezența directă a vocii lirice."
    },
    {
      "question": "Prepoziția „grație” (sinonimă cu „datorită”) cere cazul: [Sursa 93]",
      "choices": ["Acuzativ", "Genitiv", "Dativ", "Nominativ"],
      "answerIndex": 2,
      "explanation": "Prepozițiile „grație”, „mulțumită”, „datorită” se construiesc întotdeauna cu cazul Dativ."
    },
    {
      "question": "În cuvântul „cheamă”, grupul „che” notează: [Sursa 169]",
      "choices": ["Două sunete [k] și [e]", "Un singur sunet [k']", "Trei sunete", "Niciun sunet"],
      "answerIndex": 1,
      "explanation": "Deoarece este urmat de o vocală („a”) în aceeași silabă, grupul „che” notează doar consoana [k']. Litera „e” nu se aude ca vocală distinctă."
    },
    {
      "question": "Cuvintele „îmbuna”, „bunătate”, „bunăstare” formează împreună cu „bun”: [Sursa 94]",
      "choices": ["Un câmp lexical", "O familie lexicală", "O serie de sinonime", "O serie de omonime"],
      "answerIndex": 1,
      "explanation": "Toate sunt formate de la aceeași rădăcină („bun”) prin derivare sau compunere, constituind familia lexicală."
    },
    {
      "question": "Indicațiile scenice scrise între paranteze în interiorul replicilor se numesc: [Sursa 214]",
      "choices": ["Didascalii externe", "Didascalii interne", "Dialog", "Monolog"],
      "answerIndex": 1,
      "explanation": "Didascaliile care apar în corpul textului dialogat, referitoare la jocul actorilor sau ton, sunt indicații interne."
    }
  ];

  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  const DEFAULT_TIME_PER_Q = 30;

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME_PER_Q;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  // întrebările cu "Link text:" -> timp infinit
  function questionHasLinkText(q) {
    return /Link text:\s*https?:\/\/[^\s)]+/.test(q);
  }

  function setInfiniteTimerUI(){
    stopTimer();
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">∞</span>`;
    progressWrap.style.display = "none";
  }

  function startTimer(seconds){
    stopTimer();
    remaining = seconds;
    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${remaining}</span>s`;
    timeBar.style.width = "100%";

    timer = setInterval(() => {
      remaining -= 1;
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = remaining;

      const pct = (remaining / seconds) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function formatQuestionText(raw) {
    let text = raw;

    // **...** -> bold + underline
    text = text.replace(/\*\*(.+?)\*\*/g, '<span class="emph">$1</span>');

    // (Link text: URL) -> link + spațiu înainte de ")"
    text = text.replace(
      /\(Link text:\s*(https?:\/\/[^\s)]+)\)/g,
      (m, url) => `(Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a> )`
    );

    // Link text: URL (cu punctuație după) -> link
    text = text.replace(
      /Link text:\s*(https?:\/\/[^\s),.]+)([),.]?)/g,
      (m, url, punct) => `Link text: <a href="${url}" target="_blank" rel="noopener noreferrer">${url}</a>${punct || ""}`
    );

    return text;
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const hasLink = questionHasLinkText(q.question);

    app.innerHTML = `
      <h2>${formatQuestionText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${c}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>${hasLink ? `Timp / întrebare: <code>∞</code>` : `Timp / întrebare: <code>${DEFAULT_TIME_PER_Q}s</code>`}</div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        document.getElementById("feedback").innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    if (hasLink) setInfiniteTimerUI();
    else startTimer(DEFAULT_TIME_PER_Q);
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${q.choices[selectedIndex]}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    document.getElementById("feedback").innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${q.choices[correct]}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${q.explanation ?? "(fără explicație)"}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    document.getElementById("scoreNow").textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe quiz-ul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
