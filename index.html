<!doctype html>
<html lang="ro">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Quiz Matematică</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; max-width: 980px; margin: 24px auto; padding: 0 16px; }
    .topbar { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .badge { display:inline-block; padding:6px 10px; border:1px solid #ddd; border-radius:999px; font-size:14px; }
    .card { border:1px solid #e5e5e5; border-radius:14px; padding:16px; margin:14px 0; box-shadow: 0 2px 10px rgba(0,0,0,0.04); }
    h1 { margin: 0 0 10px; font-size: 22px; }
    h2 { margin: 0 0 10px; font-size: 18px; line-height: 1.35; }
    .choices { margin: 10px 0; }
    .choice { display:flex; gap:10px; padding:10px; border:1px solid #eee; border-radius:12px; margin:8px 0; cursor:pointer; }
    .choice:hover { background: #fafafa; }
    .choice input { margin-top: 3px; }
    button { padding:10px 14px; border-radius:12px; border:1px solid #ddd; background:white; cursor:pointer; font-weight:600; }
    button:hover { background:#f6f6f6; }
    button.primary { background:#111; color:#fff; border-color:#111; }
    button.primary:hover { background:#222; }
    .row { display:flex; gap:10px; flex-wrap:wrap; }
    .muted { opacity:.75; }
    .result { padding: 12px; border-radius: 12px; border: 1px solid #e9e9e9; background: #fbfbfb; margin-top: 12px; }
    .ok { border-color: #cfead6; background: #f3fbf5; }
    .bad { border-color: #ffd0d0; background: #fff5f5; }
    .timer { font-variant-numeric: tabular-nums; }
    .progress { height: 10px; background: #eee; border-radius: 999px; overflow:hidden; margin-top: 10px; }
    .progress > div { height:100%; width:0%; background:#111; transition: width .2s linear; }
    .footer { margin-top: 18px; display:flex; justify-content:space-between; gap: 12px; flex-wrap:wrap; }
    .small { font-size: 13px; }
    code { background:#f6f6f6; padding:2px 6px; border-radius:8px; }
    .emph { font-weight: 700; text-decoration: underline; }
  </style>
</head>
<body>

<h1>Quiz Matematică</h1>

<div class="topbar">
  <div class="badge" id="qCounter">Întrebarea 1 / 1</div>
  <div class="badge timer" id="timerBadge">⏳ Timp rămas: <span id="timeLeft">02:00</span></div>
</div>
<div class="progress" id="progressWrap"><div id="timeBar"></div></div>

<div id="app" class="card"></div>

<script>
  // === Întrebări (JSON-ul tău) ===
  const rawQuestions = [
    {
      "question": "Rezultatul calculului 2026 - 12 : 12 este:",
      "choices": ["-1","0","2025","2026"],
      "answerIndex": 2,
      "explanation": "Conform ordinii operațiilor, se efectuează întâi împărțirea și apoi scăderea: 2026 - 1 = 2025. Sursa: [1], [2]."
    },
    {
      "question": "Cel mai mare divizor comun al numerelor 3 și 4 este:",
      "choices": ["3","4","1","12"],
      "answerIndex": 2,
      "explanation": "Numerele 3 și 4 sunt prime între ele (numere consecutive), deci cel mai mare divizor comun al lor este 1. Sursa: [2]."
    },
    {
      "question": "Dacă 25% dintr-un număr a este 30, atunci 30% din același număr a este:",
      "choices": ["25","40","24","36"],
      "answerIndex": 3,
      "explanation": "Dacă 25% din a = 30, atunci a = 30 * 4 = 120. 30% din 120 este (30/100) * 120 = 36. Sursa: [2]."
    },
    {
      "question": "Suma numerelor naturale din intervalul (-5, 5) este:",
      "choices": ["-5","0","5","10"],
      "answerIndex": 3,
      "explanation": "Numerele naturale din intervalul (-5, 5) sunt {0, 1, 2, 3, 4}. Suma lor este 0+1+2+3+4 = 10. Sursa: [2]."
    },
    {
      "question": "Media aritmetică a numerelor a = √12 și b = 4 - 2√3 este:",
      "choices": ["4√3","2","4","4 + 4√3"],
      "answerIndex": 1,
      "explanation": "a = √12 = 2√3. Media aritmetică este (a+b)/2 = (2√3 + 4 - 2√3) / 2 = 4 / 2 = 2. Sursa: [2]."
    },
    {
      "question": "Un sfert din numărul 2^2026 este egal cu:",
      "choices": ["2^2024","2^506","2^2025","2^2022"],
      "answerIndex": 0,
      "explanation": "Un sfert înseamnă împărțirea la 4 (adică 2^2). 2^2026 : 2^2 = 2^(2026-2) = 2^2024. Sursa: [3]."
    },
    {
      "question": "În figura alăturată, sunt reprezentate punctele coliniare A, B, C și D, în această ordine. Știind că AC=18 cm, iar BD=12 cm, iar C este mijlocul lui BD, atunci lungimea segmentului AB este:",
      "choices": ["12 cm","6 cm","18 cm","24 cm"],
      "answerIndex": 0,
      "explanation": "Dacă C este mijlocul lui BD și BD=12, atunci BC=6. Deoarece punctele sunt în ordinea A-B-C, avem AC = AB + BC. Deci 18 = AB + 6, rezultă AB = 12 cm. Sursa: [3]."
    },
    {
      "question": "În triunghiul ABC, AC = 6 cm, unghiul A = 30° și aria triunghiului ABC este de 18 cm². Atunci lungimea laturii AB este egală cu:",
      "choices": ["14 cm","12 cm","8 cm","6 cm"],
      "answerIndex": 1,
      "explanation": "Aria = (AB * AC * sin A) / 2. 18 = (AB * 6 * 1/2) / 2. 18 = (3 * AB) / 2. 36 = 3 * AB, deci AB = 12 cm. Sursa: [4]."
    },
    {
      "question": "Un cerc are diametrul de 14 cm. Aria discului determinat de cerc este:",
      "choices": ["14π cm²","49π cm²","196π cm²","7π cm²"],
      "answerIndex": 1,
      "explanation": "Raza este jumătate din diametru, deci r = 7 cm. Aria = π * r² = π * 7² = 49π cm². Sursa: [5], [6]."
    },
    {
      "question": "Rezultatul calculului 45 : 5 + (-2) · 2 este egal cu:",
      "choices": ["14","22","13","5"],
      "answerIndex": 3,
      "explanation": "45 : 5 = 9. (-2) · 2 = -4. Deci 9 + (-4) = 5. Sursa: [7]."
    },
    {
      "question": "Dacă a și b sunt două numere raționale nenule, astfel încât a/5 = 3/b, atunci rezultatul calculului 80 - 2ab este egal cu:",
      "choices": ["65","-220","50","95"],
      "answerIndex": 1,
      "explanation": "Din a/5 = 3/b rezultă ab = 15. Calculul devine 80 - 20 * 15 = 80 - 300 = -220. Sursa: [8] (adaptat, sursa originală avea + semn sau alt context, aici calculul matematic strict pe baza egalității). Nota: În sursă rezultatul marcat este 50, ceea ce ar implica 2a/5 = 3/5b sau altă expresie. Corectând conform textului sursei '2a/5 = 3/5b' este neclar, dar dacă ab=15, 80-300=-220. Dacă sursa [8] cere 80-2ab și ab=15, ar fi 50. Vom asuma întrebarea standard ab=15 și cerința 80 - 2ab = 50. Răspuns ajustat pentru 50.",
      "correctedAnswerIndex": 2,
      "correctedExplanation": " 80 - 2ab (unde ab=15 din proporție simplă a/3=5/b sau similar), rezultatul 50 este plauzibil. ."
    },
    {
      "question": "Cel mai mic număr întreg din mulțimea A = {x ∈ ℝ | -3 < 2x + 3 ≤ 5} este egal cu:",
      "choices": ["-3","-2","-4","1"],
      "answerIndex": 1,
      "explanation": "-3 < 2x + 3 ≤ 5 => -6 < 2x ≤ 2 => -3 < x ≤ 1. Numerele întregi sunt {-2, -1, 0, 1}. Cel mai mic este -2. Sursa: [8]."
    },
    {
      "question": "Un paralelogram are o latură de 9 cm, alta de 6 cm, iar măsura unui unghi ascuțit de 30°. Aria paralelogramului este:",
      "choices": ["54 cm²","27 cm²","27√3 cm²","18 cm²"],
      "answerIndex": 1,
      "explanation": "Aria = L * l * sin(u) = 9 * 6 * sin(30°) = 54 * 1/2 = 27 cm². Sursa: [5]."
    },
    {
      "question": "Diagonala unui cub cu muchia de 4 cm are lungimea de:",
      "choices": ["4 cm","4√2 cm","4√3 cm","8 cm"],
      "answerIndex": 2,
      "explanation": "Formula diagonalei cubului este l√3. Pentru l=4, diagonala este 4√3 cm. Sursa: [9], [10]."
    },
    {
      "question": "Dacă a/3 = 13/2, atunci valoarea raportului (a-3)/3 este:",
      "choices": ["4,(6)","5","5,5","6,5"],
      "answerIndex": 2,
      "explanation": "Din a/3 = 13/2 rezultă a = 39/2 = 19,5. Valoarea cerută este (19,5 - 3) / 3 = 16,5 / 3 = 5,5. Sursa: [11]."
    },
    {
      "question": "Diferența dintre media aritmetică și media geometrică a numerelor a = 4 + √7 și b = 4 - √7 este:",
      "choices": ["-1","0","4","1"],
      "answerIndex": 3,
      "explanation": "Ma = (4+√7 + 4-√7)/2 = 8/2 = 4. Mg = √((4+√7)(4-√7)) = √(16-7) = √9 = 3. Diferența Ma - Mg = 4 - 3 = 1. Sursa: [12]."
    },
    {
      "question": "În figura alăturată (descriere), M este mijlocul segmentului BC. Dacă aria triunghiului ABC este 54 cm² și AB = 9 cm (triunghi dreptunghic în B), lungimea lui BC este:",
      "choices": ["6 cm","9 cm","12 cm","15 cm"],
      "answerIndex": 2,
      "explanation": "Aria = (cateta1 * cateta2) / 2. 54 = (9 * BC) / 2 => 108 = 9 * BC => BC = 12 cm. (Notă: Sursa [13] menționează un triunghi cu aceste date, deși contextul complet variază, calculul ariei rămâne valabil). Sursa: [13]."
    },
    {
      "question": "Suma muchiilor unei piramide patrulatere regulate cu toate muchiile egale cu 6 cm este:",
      "choices": ["24 cm","36 cm","48 cm","60 cm"],
      "answerIndex": 2,
      "explanation": "Piramida are 4 muchii ale bazei și 4 muchii laterale. Total 8 muchii. Suma = 8 * 6 = 48 cm. Sursa: [14], [15]."
    },
    {
      "question": "Probabilitatea ca alegând un număr din mulțimea A = {1, 2, 3, ..., 90}, acesta să fie pătrat perfect este:",
      "choices": ["4/45","1/10","5/9","9/10"],
      "answerIndex": 1,
      "explanation": "Pătratele perfecte până la 90 sunt: 1, 4, 9, 16, 25, 36, 49, 64, 81. Sunt 9 numere. Total cazuri = 90. Probabilitatea = 9/90 = 1/10. Sursa: [16]."
    },
    {
      "question": "Soluția ecuației |x - 5| = 1 în mulțimea numerelor întregi este:",
      "choices": ["{6}","{4}","{4, 6}","{-4, -6}"],
      "answerIndex": 2,
      "explanation": "|x - 5| = 1 implică x - 5 = 1 sau x - 5 = -1. Deci x = 6 sau x = 4. Sursa: [17]."
    },
    {
      "question": "Un trapez dreptunghic are bazele de 20 cm și 12 cm, iar latura neparalelă oblică de 10 cm. Aria trapezului este:",
      "choices": ["96 cm²","100 cm²","160 cm²","192 cm²"],
      "answerIndex": 0,
      "explanation": "Ducem înălțimea din capătul bazei mici. Se formează un triunghi dreptunghic cu ipotenuza 10 și o catetă 20-12=8. Înălțimea h = √(10² - 8²) = 6. Aria = (20+12)*6/2 = 96 cm². Sursa: [18]."
    },
    {
      "question": "Dacă x + 3y = 5, atunci valoarea expresiei 3x + 9y + 12 este:",
      "choices": ["15","17","24","27"],
      "answerIndex": 3,
      "explanation": "3x + 9y + 12 = 3(x + 3y) + 12 = 3 * 5 + 12 = 15 + 12 = 27. Sursa: [19]."
    },
    {
      "question": "Rezultatul calculului (3n - 7)² este:",
      "choices": ["9n² - 49","9n² + 49","9n² - 42n + 49","9n² - 21n + 49"],
      "answerIndex": 2,
      "explanation": "Aplicând formula (a-b)² = a² - 2ab + b², obținem (3n)² - 2*3n*7 + 7² = 9n² - 42n + 49. Sursa: [20]."
    },
    {
      "question": "Media geometrică a numerelor 16 și 25 este:",
      "choices": ["20","20,5","41","400"],
      "answerIndex": 0,
      "explanation": "Media geometrică este √(16 * 25) = √400 = 20 (sau 4 * 5). Sursa: [21]."
    },
    {
      "question": "Aria unui triunghi echilateral cu perimetrul de 12 cm este:",
      "choices": ["4√3 cm²","36 cm²","12√3 cm²","9√3 cm²"],
      "answerIndex": 0,
      "explanation": "Latura = Perimetru / 3 = 12 / 3 = 4 cm. Aria = (l²√3) / 4 = (16√3) / 4 = 4√3 cm². Sursa: [9]."
    }
  ];

  // Normalizăm: dacă există correctedAnswerIndex/Explanation, le folosim
  const questions = rawQuestions.map(q => ({
    question: q.question,
    choices: q.choices,
    answerIndex: (typeof q.correctedAnswerIndex === "number") ? q.correctedAnswerIndex : q.answerIndex,
    explanation: (q.correctedExplanation ?? q.explanation) ?? ""
  }));

  const app = document.getElementById("app");
  const qCounter = document.getElementById("qCounter");
  const timeBar = document.getElementById("timeBar");
  const timerBadge = document.getElementById("timerBadge");
  const progressWrap = document.getElementById("progressWrap");

  // Timere: 2 minute default, 7 minute pentru geometrie / figuri / puncte coliniare
  const DEFAULT_TIME_PER_Q = 120; // 2 min
  const GEOM_TIME_PER_Q = 420;    // 7 min

  let idx = 0;
  let score = 0;
  let timer = null;
  let remaining = DEFAULT_TIME_PER_Q;
  let locked = false;

  function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

  function grade1to10(correct, total) {
    if (total <= 0) return 1;
    const ratio = correct / total;
    const g = 1 + ratio * 9; // 0% -> 1, 100% -> 10
    return Math.round(g * 100) / 100;
  }

  function stopTimer(){
    if (timer) { clearInterval(timer); timer = null; }
  }

  function escapeHtml(s){
    return String(s)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function formatText(raw) {
    let text = escapeHtml(raw);
    // **...** -> bold + underline
    text = text.replace(/\*\*(.+?)\*\*/g, '<span class="emph">$1</span>');
    return text;
  }

  function isGeometryQuestion(questionText) {
    const q = questionText.toLowerCase();
    // Heuristic: figuri / geometrie / puncte coliniare / segmente / unghiuri etc.
    return /(\bfigura\b|\btriunghi\b|\bcerc\b|\bparalelogram\b|\bcub\b|\bpiramid|trapez|\bpuncte\b|\bcoliniare\b|\bsegment\b|\bunghi\b|\baria\b|\bdiagonal|muchi)/i.test(q);
  }

  function fmtTime(seconds){
    const m = Math.floor(seconds / 60);
    const s = seconds % 60;
    return String(m).padStart(2,"0") + ":" + String(s).padStart(2,"0");
  }

  function startTimer(seconds){
    stopTimer();
    remaining = seconds;
    progressWrap.style.display = "block";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">${fmtTime(remaining)}</span>`;
    timeBar.style.width = "100%";

    timer = setInterval(() => {
      remaining -= 1;
      const tl = document.getElementById("timeLeft");
      if (tl) tl.textContent = fmtTime(Math.max(remaining, 0));

      const pct = (remaining / seconds) * 100;
      timeBar.style.width = clamp(pct, 0, 100) + "%";

      if (remaining <= 0) {
        stopTimer();
        revealAnswer(null, true);
      }
    }, 1000);
  }

  function renderQuestion(){
    locked = false;
    const q = questions[idx];
    qCounter.textContent = `Întrebarea ${idx + 1} / ${questions.length}`;

    const secondsForThis = isGeometryQuestion(q.question) ? GEOM_TIME_PER_Q : DEFAULT_TIME_PER_Q;

    app.innerHTML = `
      <h2>${formatText(q.question)}</h2>
      <div class="choices">
        ${q.choices.map((c, i) => `
          <label class="choice">
            <input type="radio" name="choice" value="${i}">
            <span>${formatText(c)}</span>
          </label>
        `).join("")}
      </div>
      <div class="row">
        <button class="primary" id="submitBtn">Trimite răspuns</button>
        <button id="skipBtn">Nu știu / sari</button>
      </div>
      <div id="feedback"></div>
      <div class="footer small muted">
        <div>Scor curent: <b id="scoreNow">${score}</b> / ${questions.length}</div>
        <div>Timp / întrebare: <code>${fmtTime(secondsForThis)}</code></div>
      </div>
    `;

    document.getElementById("submitBtn").onclick = () => {
      if (locked) return;
      const picked = app.querySelector('input[name="choice"]:checked');
      if (!picked) {
        document.getElementById("feedback").innerHTML = `<div class="result">Alege un răspuns înainte să trimiți.</div>`;
        return;
      }
      revealAnswer(Number(picked.value), false);
    };

    document.getElementById("skipBtn").onclick = () => {
      if (locked) return;
      revealAnswer(null, false);
    };

    startTimer(secondsForThis);
  }

  function revealAnswer(selectedIndex, timedOut){
    locked = true;
    stopTimer();

    const q = questions[idx];
    const correct = q.answerIndex;
    const isCorrect = (selectedIndex === correct);

    if (isCorrect) score += 1;

    const pickedText = (selectedIndex === null)
      ? (timedOut ? "⏰ Timpul a expirat." : "Ai sărit întrebarea.")
      : `Ai ales: <b>${formatText(q.choices[selectedIndex])}</b>`;

    const status = isCorrect ? "✅ Corect" : "❌ Greșit";
    const boxClass = isCorrect ? "result ok" : "result bad";

    document.getElementById("feedback").innerHTML = `
      <div class="${boxClass}">
        <div style="font-size:16px; margin-bottom:6px;"><b>${status}</b></div>
        <div>${pickedText}</div>
        <div style="margin-top:8px;">
          Răspuns corect: <b>${formatText(q.choices[correct])}</b>
        </div>
        <div style="margin-top:8px; opacity:.9">
          Explicație: ${formatText(q.explanation || "(fără explicație)")}
        </div>
      </div>
      <div class="row" style="margin-top:10px;">
        <button class="primary" id="nextBtn">${idx < questions.length - 1 ? "Următoarea întrebare" : "Vezi rezultatul final"}</button>
      </div>
    `;

    document.getElementById("scoreNow").textContent = score;

    document.getElementById("nextBtn").onclick = () => {
      idx += 1;
      if (idx < questions.length) renderQuestion();
      else renderFinal();
    };
  }

  function renderFinal(){
    stopTimer();
    qCounter.textContent = "Final";
    timerBadge.innerHTML = `⏳ Timp rămas: <span id="timeLeft">—</span>`;
    progressWrap.style.display = "none";

    const total = questions.length;
    const nota = grade1to10(score, total);

    app.innerHTML = `
      <h2>Rezultat final</h2>
      <div class="result ok">
        <div>Răspunsuri corecte: <b>${score}</b> / <b>${total}</b></div>
        <div style="margin-top:8px;">Notă: <b>${nota}</b> / 10</div>
      </div>
      <div class="row" style="margin-top:12px;">
        <button class="primary" id="restartBtn">Reîncepe quiz-ul</button>
      </div>
      <p class="small muted" style="margin-top:10px;">
        Notarea este proporțională: 0% = 1, 100% = 10.
      </p>
    `;

    document.getElementById("restartBtn").onclick = () => {
      idx = 0;
      score = 0;
      renderQuestion();
    };
  }

  renderQuestion();
</script>

</body>
</html>
